<!DOCTYPE html>
<html
  lang="pt-BR"
  xmlns:th="http://www.thymeleaf.org"
  th:with="locale=${#locale}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title th:text="#{dashboard.title}">Dashboard - WorkWell</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="/css/app.css" />
    <style>
      .notification-badge {
        position: fixed;
        top: 80px;
        right: 20px;
        z-index: 1050;
        max-width: 350px;
      }
      .notification-item {
        animation: slideIn 0.3s ease-out;
      }
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      .progress-ring {
        transform: rotate(-90deg);
      }
      .agenda-item {
        transition: all 0.2s ease;
      }
      .agenda-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      .frequencia-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .frequencia-card.success {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }
      .frequencia-card.warning {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }
      .frequencia-card.danger {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      }
      .tipo-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
      }
    </style>
  </head>
  <body>
    <!-- Language Selector -->
    <div th:replace="~{fragments/language-selector :: language-selector}"></div>

    <div class="min-vh-100 d-flex flex-column">
      <!-- Header -->
      <header class="bg-white shadow-sm">
        <div class="container py-3">
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-3">
              <div class="navbar-brand mb-0">
                <img
                  src="/img/logopng.png"
                  alt="WorkWell Logo"
                  class="logo-image"
                />
              </div>
              <h1 class="h4 mb-0 fw-bold text-primary" th:text="#{app.name}">
                <i class="bi bi-speedometer2 me-2"></i>
                WorkWell
              </h1>
            </div>
            <div class="d-flex align-items-center gap-3">
              <span class="text-muted" id="userInfo"></span>
              <button
                class="btn btn-outline-danger btn-sm"
                id="btnLogout"
                th:text="#{app.logout}"
              >
                <i class="bi bi-box-arrow-right me-1"></i>
                Sair
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Notifica√ß√µes Inteligentes -->
      <div class="notification-badge" id="notificacoesContainer"></div>

      <!-- Main Content -->
      <main class="flex-grow-1 bg-light">
        <div class="container py-5">
          <!-- T√≠tulo e Sauda√ß√£o -->
          <div class="row mb-4" id="secaoTituloSaudacao">
            <div class="col-12">
              <h2 class="h3 fw-bold mb-2" th:text="#{dashboard.greeting}">
                Ol√°! üëã
              </h2>
              <p class="text-muted" th:text="#{dashboard.subtitle}">
                Aqui est√° sua agenda e progresso de hoje
              </p>
            </div>
          </div>

          <!-- Frequ√™ncia de Participa√ß√£o -->
          <div class="row mb-4" id="secaoFrequencia">
            <div class="col-12">
              <div
                class="card shadow-sm border-0 frequencia-card"
                id="frequenciaCard"
              >
                <div class="card-body p-4">
                  <div class="row align-items-center">
                    <div class="col-md-8">
                      <h5
                        class="card-title text-white mb-3"
                        th:text="#{dashboard.frequency.title}"
                      >
                        Sua Frequ√™ncia de Participa√ß√£o
                      </h5>
                      <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                          <span
                            class="text-white-50"
                            th:text="#{dashboard.frequency.progress}"
                            >Progresso</span
                          >
                          <span
                            class="text-white fw-bold"
                            id="percentualFrequencia"
                            >0%</span
                          >
                        </div>
                        <div
                          class="progress"
                          style="
                            height: 24px;
                            border-radius: 12px;
                            background-color: rgba(255, 255, 255, 0.3);
                          "
                        >
                          <div
                            class="progress-bar"
                            id="barraFrequencia"
                            role="progressbar"
                            style="
                              width: 0%;
                              border-radius: 12px;
                              background-color: white;
                            "
                            aria-valuenow="0"
                            aria-valuemin="0"
                            aria-valuemax="100"
                          ></div>
                        </div>
                      </div>
                      <p
                        class="text-white mb-0"
                        id="mensagemMotivacional"
                        th:text="#{dashboard.frequency.loading}"
                      >
                        Carregando...
                      </p>
                      <small class="text-white-50 d-block mt-2">
                        <span id="atividadesParticipadas">0</span>
                        <span th:text="#{app.loading}">de</span>
                        <span id="totalAtividades">0</span>
                        <span th:text="#{dashboard.frequency.activities}"
                          >atividades e avalia√ß√µes nos √∫ltimos 30 dias</span
                        >
                      </small>
                    </div>
                    <div class="col-md-4 text-center">
                      <div
                        class="display-1 text-white fw-bold"
                        id="percentualGrande"
                      >
                        0%
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Se√ß√£o de Intelig√™ncia Artificial -->
          <div class="row mb-4" id="secaoIA" style="display: none">
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom">
                  <h5 class="mb-0 fw-bold">
                    ü§ñ
                    <span th:text="#{dashboard.ai.title}"
                      >Assistente de IA - WorkWell</span
                    >
                    <span
                      class="badge bg-primary ms-2"
                      th:text="#{dashboard.ai.beta}"
                      >Beta</span
                    >
                  </h5>
                </div>
                <div class="card-body">
                  <div class="row g-4">
                    <!-- Chat Assistente - Todos os roles -->
                    <div class="col-md-6 col-lg-4">
                      <div class="card h-100 border-primary">
                        <div class="card-body">
                          <h6
                            class="card-title fw-bold"
                            th:text="#{dashboard.ai.chat.title}"
                          >
                            üí¨ Chat Assistente
                          </h6>
                          <p
                            class="card-text text-muted small"
                            th:text="#{dashboard.ai.chat.description}"
                          >
                            Converse com nosso assistente virtual sobre
                            bem-estar, sa√∫de mental e quest√µes do trabalho.
                          </p>
                          <button
                            class="btn btn-primary btn-sm w-100"
                            onclick="abrirChatIA()"
                            th:text="#{dashboard.ai.chat.button}"
                          >
                            Abrir Chat
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- An√°lise de Sentimentos - Funcion√°rio e RH -->
                    <div
                      class="col-md-6 col-lg-4"
                      id="cardAnaliseSentimento"
                      style="display: none"
                    >
                      <div class="card h-100 border-info">
                        <div class="card-body">
                          <h6
                            class="card-title fw-bold"
                            th:text="#{dashboard.ai.sentiment.title}"
                          >
                            üìä An√°lise de Sentimentos
                          </h6>
                          <p
                            class="card-text text-muted small"
                            th:text="#{dashboard.ai.sentiment.description}"
                          >
                            Analise seus registros de humor e obtenha insights
                            sobre seu bem-estar emocional.
                          </p>
                          <button
                            class="btn btn-info btn-sm w-100"
                            onclick="abrirAnaliseSentimento()"
                            th:text="#{dashboard.ai.sentiment.button}"
                          >
                            Analisar Sentimentos
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Sugest√µes de Atividades - Funcion√°rio -->
                    <div
                      class="col-md-6 col-lg-4"
                      id="cardSugestaoAtividade"
                      style="display: none"
                    >
                      <div class="card h-100 border-success">
                        <div class="card-body">
                          <h6
                            class="card-title fw-bold"
                            th:text="#{dashboard.ai.suggestions.title}"
                          >
                            üí° Sugest√µes de Atividades
                          </h6>
                          <p
                            class="card-text text-muted small"
                            th:text="#{dashboard.ai.suggestions.description}"
                          >
                            Receba sugest√µes personalizadas de atividades de
                            bem-estar baseadas no seu perfil.
                          </p>
                          <button
                            class="btn btn-success btn-sm w-100"
                            onclick="abrirSugestaoAtividade()"
                            th:text="#{dashboard.ai.suggestions.button}"
                          >
                            Ver Sugest√µes
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Insights RH - Apenas RH -->
                    <div
                      class="col-md-6 col-lg-4"
                      id="cardInsightsRH"
                      style="display: none"
                    >
                      <div class="card h-100 border-warning">
                        <div class="card-body">
                          <h6 class="card-title fw-bold">
                            üìà Insights Estrat√©gicos
                          </h6>
                          <p class="card-text text-muted small">
                            Obtenha insights estrat√©gicos baseados nos dados do
                            dashboard para tomada de decis√£o.
                          </p>
                          <button
                            class="btn btn-warning btn-sm w-100"
                            onclick="abrirInsightsRH()"
                          >
                            Gerar Insights
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Agenda do Dia -->
          <div class="row mb-4" id="secaoAgenda">
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom">
                  <h5 class="mb-0 fw-bold">
                    üìÖ
                    <span th:text="#{dashboard.agenda.title}"
                      >Agenda de Hoje</span
                    >
                    <span class="badge bg-primary ms-2" id="totalAgenda"
                      >0</span
                    >
                  </h5>
                </div>
                <div class="card-body">
                  <div id="agendaContainer">
                    <div class="text-center text-muted py-4">
                      <p class="mb-0" th:text="#{dashboard.agenda.empty}">
                        Nenhuma atividade ou consulta agendada para hoje
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Hist√≥rico de Participa√ß√£o -->
          <div class="row mb-4" id="secaoHistorico">
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom">
                  <h5 class="mb-0 fw-bold">
                    üìä
                    <span th:text="#{dashboard.agenda.history.title}"
                      >Hist√≥rico de Participa√ß√£o</span
                    >
                    <span class="badge bg-secondary ms-2" id="totalHistorico"
                      >0</span
                    >
                  </h5>
                </div>
                <div class="card-body">
                  <div id="historicoContainer">
                    <div class="text-center text-muted py-4">
                      <p
                        class="mb-0"
                        th:text="#{dashboard.agenda.history.loading}"
                      >
                        Carregando hist√≥rico...
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Enquetes R√°pidas para Funcion√°rios -->
          <div class="row mb-4" id="secaoEnquetesRapidas" style="display: none">
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom">
                  <h5
                    class="mb-0 fw-bold"
                    th:text="'üìä ' + #{dashboard.surveys.title}"
                  >
                    üìä Enquetes R√°pidas
                  </h5>
                </div>
                <div class="card-body">
                  <div class="row g-4" id="enquetesRapidasContainer">
                    <div class="col-12">
                      <div class="text-center text-muted py-4">
                        <p class="mb-0">Carregando enquetes...</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Atividades de Bem-Estar para Funcion√°rios -->
          <div
            class="row mb-4"
            id="secaoAtividadesBemEstar"
            style="display: none"
          >
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom">
                  <h5
                    class="mb-0 fw-bold"
                    th:text="'üíö ' + #{dashboard.activities.title}"
                  >
                    üíö Atividades de Bem-Estar
                  </h5>
                </div>
                <div class="card-body">
                  <div class="row g-4" id="atividadesBemEstarContainer">
                    <div class="col-12">
                      <div class="text-center text-muted py-4">
                        <p class="mb-0">Carregando atividades...</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Avalia√ß√µes Profundas para Funcion√°rios -->
          <div
            class="row mb-4"
            id="secaoAvaliacoesProfundasFuncionario"
            style="display: none"
          >
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom">
                  <h5
                    class="mb-0 fw-bold"
                    th:text="'üìã ' + #{dashboard.evaluations.title}"
                  >
                    üìã Avalia√ß√µes Profundas (NR-1)
                  </h5>
                </div>
                <div class="card-body">
                  <p
                    class="text-muted small mb-3"
                    th:text="#{dashboard.evaluations.description}"
                  >
                    Avalia√ß√µes semanais de sa√∫de ocupacional conforme NR-1.
                    Responda √†s avalia√ß√µes dispon√≠veis para contribuir com seu
                    bem-estar.
                  </p>
                  <div
                    class="row g-4"
                    id="avaliacoesProfundasFuncionarioContainer"
                  >
                    <div class="col-12">
                      <div class="text-center text-muted py-4">
                        <p class="mb-0">Carregando avalia√ß√µes...</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Avalia√ß√µes Profundas (NR-1) - Apenas para PSICOLOGO -->
          <div
            class="row mb-4"
            id="secaoAvaliacoesProfundas"
            style="display: none"
          >
            <div class="col-12">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h2
                  class="h4 fw-bold mb-0"
                  th:text="'üìã ' + #{dashboard.evaluations.title}"
                >
                  üìã Avalia√ß√µes Profundas (NR-1)
                </h2>
                <button class="btn btn-primary" id="btnCriarAvaliacaoProfunda">
                  <strong>+ Nova Avalia√ß√£o</strong>
                </button>
              </div>
              <p class="text-muted small mb-3">
                Crie avalia√ß√µes semanais para monitoramento de sa√∫de ocupacional
                conforme NR-1. Relat√≥rios confidenciais com respostas detalhadas
                e an√°lises estat√≠sticas.
              </p>
            </div>
          </div>

          <div
            class="row g-4 mb-5"
            id="avaliacoesProfundasContainer"
            style="display: none"
          ></div>

          <!-- Minhas Avalia√ß√µes Criadas - Apenas para PSICOLOGO -->
          <div
            class="row mb-4"
            id="secaoMinhasAvaliacoes"
            style="display: none"
          >
            <div class="col-12">
              <h2 class="h4 fw-bold mb-3">üìä Minhas Avalia√ß√µes Criadas</h2>
              <div class="row g-4 mb-5" id="minhasAvaliacoesContainer"></div>
            </div>
          </div>

          <!-- Canal de Den√∫ncias √âticas - Apenas para ADMIN -->
          <div class="row mb-4" id="secaoCanalDenuncias" style="display: none">
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom">
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <h2
                      class="h4 fw-bold mb-0"
                      th:text="'üõ°Ô∏è ' + #{dashboard.complaints.title}"
                    >
                      üõ°Ô∏è Canal de Den√∫ncias √âticas
                    </h2>
                    <span
                      class="badge bg-danger"
                      id="badgeDenunciasPendentes"
                      style="display: none"
                      >0 pendentes</span
                    >
                  </div>
                </div>
                <div class="card-body">
                  <p class="text-muted mb-4">
                    Espa√ßo 100% sigiloso e independente da empresa para registro
                    de den√∫ncias √©ticas. Todas as den√∫ncias s√£o tratadas com
                    total confidencialidade.
                  </p>

                  <!-- Filtros -->
                  <div class="row mb-3">
                    <div class="col-md-4">
                      <select class="form-select" id="filtroStatusDenuncias">
                        <option value="">Todas as den√∫ncias</option>
                        <option value="PENDENTE">Pendentes</option>
                        <option value="EM_ANALISE">Em An√°lise</option>
                        <option value="RESOLVIDA">Resolvidas</option>
                        <option value="ARQUIVADA">Arquivadas</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <button
                        class="btn btn-primary"
                        id="btnAtualizarDenuncias"
                      >
                        Atualizar Lista
                      </button>
                    </div>
                  </div>

                  <!-- Lista de Den√∫ncias -->
                  <div id="denunciasContainer">
                    <div class="text-center text-muted py-4">
                      <p class="mb-0">Carregando den√∫ncias...</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Cards de Acesso R√°pido -->
          <div class="row g-4">
            <div class="col-md-6 col-lg-4" id="cardEspacoApoio">
              <div class="card shadow-sm border-0 h-100">
                <div class="card-body">
                  <h5
                    class="card-title"
                    th:text="'üíö ' + #{dashboard.support.title}"
                  >
                    üíö Espa√ßo de Apoio
                  </h5>
                  <p
                    class="card-text text-muted"
                    th:text="#{dashboard.support.description}"
                  >
                    Acesse recursos de bem-estar e suporte psicol√≥gico.
                  </p>
                  <a
                    href="/espaco-apoio"
                    class="btn btn-primary"
                    th:text="#{dashboard.support.access}"
                    >Acessar</a
                  >
                </div>
              </div>
            </div>
            <div
              class="col-md-6 col-lg-4"
              id="cardDashboardRh"
              style="display: none"
            >
              <div class="card shadow-sm border-0 h-100">
                <div class="card-body">
                  <h5 class="card-title">üìà Dashboard RH</h5>
                  <p class="card-text text-muted">
                    Acesse indicadores, enquetes e atividades de bem-estar.
                  </p>
                  <a href="/dashboard-rh" class="btn btn-primary">Acessar</a>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-4" id="cardMoodCheck">
              <div class="card shadow-sm border-0 h-100">
                <div class="card-body">
                  <h5
                    class="card-title"
                    th:text="'üòä ' + #{dashboard.mood.title}"
                  >
                    üòä Mood Check
                  </h5>
                  <p
                    class="card-text text-muted"
                    th:text="#{dashboard.mood.description}"
                  >
                    Registre como voc√™ est√° se sentindo hoje.
                  </p>
                  <button
                    class="btn btn-primary"
                    id="btnRegistrarHumor"
                    th:text="#{dashboard.mood.register}"
                  >
                    Registrar Humor
                  </button>
                </div>
              </div>
            </div>
            <div
              class="col-md-6 col-lg-4"
              id="cardDenunciaEtica"
              style="display: none"
            >
              <div class="card shadow-sm border-0 h-100 border-danger">
                <div class="card-body">
                  <h5
                    class="card-title"
                    th:text="'üõ°Ô∏è ' + #{dashboard.complaints.title}"
                  >
                    üõ°Ô∏è Canal de Den√∫ncias √âticas
                  </h5>
                  <p
                    class="card-text text-muted"
                    th:text="#{dashboard.complaints.description}"
                  >
                    Registre den√∫ncias de forma 100% sigilosa e independente da
                    empresa.
                  </p>
                  <button
                    class="btn btn-danger"
                    id="btnRegistrarDenuncia"
                    th:text="#{dashboard.complaints.register}"
                  >
                    Registrar Den√∫ncia
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer class="bg-white border-top py-4 mt-auto">
        <div class="container text-center text-muted small">
          <p class="mb-0">
            &copy; 2025 WorkWell. Todos os direitos reservados.
          </p>
        </div>
      </footer>
    </div>

    <!-- Modal Criar Avalia√ß√£o Profunda -->
    <div class="modal fade" id="modalCriarAvaliacaoProfunda" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Criar Nova Avalia√ß√£o Profunda (NR-1)</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="formCriarAvaliacaoProfunda">
              <div class="mb-3">
                <label class="form-label">T√≠tulo da Avalia√ß√£o</label>
                <input
                  type="text"
                  class="form-control"
                  id="avaliacaoTitulo"
                  required
                  placeholder="Ex: Avalia√ß√£o Semanal de Bem-Estar - Semana 1"
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Descri√ß√£o</label>
                <textarea
                  class="form-control"
                  id="avaliacaoDescricao"
                  rows="3"
                  placeholder="Descreva o objetivo desta avalia√ß√£o..."
                ></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Perguntas</label>
                <div id="perguntasContainer">
                  <div class="card mb-3 pergunta-item">
                    <div class="card-body">
                      <div class="row mb-2">
                        <div class="col-md-8">
                          <input
                            type="text"
                            class="form-control pergunta-texto"
                            placeholder="Digite a pergunta..."
                            required
                          />
                        </div>
                        <div class="col-md-4">
                          <select class="form-select pergunta-tipo" required>
                            <option value="TEXTO">Texto Livre</option>
                            <option value="NUMERICO">Num√©rico (1-10)</option>
                            <option value="ESCOLHA">Escolha √önica</option>
                          </select>
                        </div>
                      </div>
                      <div class="opcoes-escolha" style="display: none">
                        <label class="form-label small"
                          >Op√ß√µes de Resposta</label
                        >
                        <div class="opcoes-container">
                          <div class="input-group mb-2">
                            <input
                              type="text"
                              class="form-control opcao-input"
                              placeholder="Op√ß√£o 1"
                            />
                            <button
                              type="button"
                              class="btn btn-outline-danger btn-sm"
                              onclick="removerOpcaoEscolha(this)"
                            >
                              Remover
                            </button>
                          </div>
                        </div>
                        <button
                          type="button"
                          class="btn btn-sm btn-outline-primary"
                          onclick="adicionarOpcaoEscolha(this)"
                        >
                          + Adicionar Op√ß√£o
                        </button>
                      </div>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline-danger mt-2"
                        onclick="removerPergunta(this)"
                      >
                        Remover Pergunta
                      </button>
                    </div>
                  </div>
                </div>
                <button
                  type="button"
                  class="btn btn-sm btn-outline-primary"
                  onclick="adicionarPergunta()"
                >
                  + Adicionar Pergunta
                </button>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Data/Hora de In√≠cio</label>
                  <input
                    type="datetime-local"
                    class="form-control"
                    id="avaliacaoDataInicio"
                    required
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Data/Hora de T√©rmino</label>
                  <input
                    type="datetime-local"
                    class="form-control"
                    id="avaliacaoDataFim"
                    required
                  />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="btnSalvarAvaliacaoProfunda"
            >
              Criar Avalia√ß√£o
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Ver Relat√≥rio -->
    <div class="modal fade" id="modalVerRelatorio" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalRelatorioTitulo">
              Relat√≥rio Confidencial
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div id="relatorioContainer"></div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Registrar Humor -->
    <div class="modal fade" id="modalRegistrarHumor" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" th:text="#{dashboard.mood.question}">
              Como voc√™ est√° se sentindo?
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="formRegistrarHumor">
              <div class="mb-3">
                <label class="form-label" th:text="#{dashboard.mood.level}"
                  >N√≠vel de Humor (1-5)</label
                >
                <div class="d-flex justify-content-between mb-2">
                  <span th:text="#{dashboard.mood.very.bad}">Muito Ruim</span>
                  <span th:text="#{dashboard.mood.very.good}">Muito Bom</span>
                </div>
                <input
                  type="range"
                  class="form-range"
                  id="humorNivel"
                  min="1"
                  max="5"
                  value="3"
                  required
                />
                <div class="text-center mt-2">
                  <span class="badge bg-primary" id="humorNivelDisplay">3</span>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label" th:text="#{dashboard.mood.sector}"
                  >Setor (opcional)</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="humorSetor"
                  placeholder="Ex: TI, Vendas, etc."
                />
              </div>
              <div class="mb-3">
                <label
                  class="form-label"
                  th:text="#{dashboard.mood.observations}"
                  >Observa√ß√µes (opcional)</label
                >
                <textarea
                  class="form-control"
                  id="humorObservacoes"
                  rows="3"
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              th:text="#{dashboard.mood.cancel}"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="btnSalvarHumor"
              th:text="#{dashboard.mood.submit}"
            >
              Registrar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Responder Avalia√ß√£o Profunda -->
    <div class="modal fade" id="modalResponderAvaliacaoProfunda" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalResponderAvaliacaoTitulo">
              Responder Avalia√ß√£o Profunda
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="formResponderAvaliacaoProfunda">
              <div class="mb-3">
                <p class="text-muted" id="modalResponderAvaliacaoDescricao"></p>
              </div>
              <div id="respostasContainer"></div>
              <div class="mb-3">
                <label class="form-label"
                  >Observa√ß√µes Adicionais (opcional)</label
                >
                <textarea
                  class="form-control"
                  id="avaliacaoObservacoes"
                  rows="3"
                  placeholder="Adicione qualquer observa√ß√£o adicional..."
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="btnSalvarRespostaAvaliacaoProfunda"
            >
              Enviar Respostas
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Registrar Den√∫ncia √âtica -->
    <div class="modal fade" id="modalRegistrarDenuncia" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" th:text="'üõ°Ô∏è ' + #{modal.complaint.title}">
              üõ°Ô∏è Registrar Den√∫ncia √âtica
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="alert alert-info">
              <strong th:text="#{modal.complaint.confidentiality} + ':'"
                >Confidencialidade Garantida:</strong
              >
              <span th:text="#{modal.complaint.confidentiality.text}"
                >Esta den√∫ncia √© 100% sigilosa e ser√° tratada com total
                confidencialidade. Seu anonimato ser√° preservado.</span
              >
            </div>
            <form id="formRegistrarDenuncia">
              <div class="mb-3">
                <label class="form-label"
                  ><span th:text="#{modal.complaint.type}"
                    >Tipo de Den√∫ncia</span
                  >
                  <span class="text-danger">*</span></label
                >
                <select class="form-select" id="denunciaTipo" required>
                  <option value="" th:text="#{modal.complaint.type.select}">
                    Selecione o tipo...
                  </option>
                  <option value="Ass√©dio moral">Ass√©dio moral</option>
                  <option value="Ass√©dio sexual">Ass√©dio sexual</option>
                  <option value="Racismo, inj√∫ria racial e discrimina√ß√£o">
                    Racismo, inj√∫ria racial e discrimina√ß√£o
                  </option>
                  <option value="Xenofobia, LGBTQIA+fobia">
                    Xenofobia, LGBTQIA+fobia
                  </option>
                  <option value="Press√µes abusivas e carga emocional excessiva">
                    Press√µes abusivas e carga emocional excessiva
                  </option>
                  <option value="Conflitos com l√≠deres">
                    Conflitos com l√≠deres
                  </option>
                  <option value="Ambiente t√≥xico">Ambiente t√≥xico</option>
                  <option value="Falta de acessibilidade">
                    Falta de acessibilidade
                  </option>
                  <option value="Quebra de conduta √©tica">
                    Quebra de conduta √©tica
                  </option>
                  <option value="Viol√™ncia psicol√≥gica">
                    Viol√™ncia psicol√≥gica
                  </option>
                  <option value="Bullying no ambiente corporativo">
                    Bullying no ambiente corporativo
                  </option>
                  <option value="Outro">Outro</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label"
                  ><span th:text="#{modal.complaint.description}"
                    >Descri√ß√£o da Den√∫ncia</span
                  >
                  <span class="text-danger">*</span></label
                >
                <textarea
                  class="form-control"
                  id="denunciaDescricao"
                  rows="6"
                  required
                  th:attr="placeholder=#{modal.complaint.description.placeholder}"
                  placeholder="Descreva detalhadamente a situa√ß√£o que voc√™ deseja denunciar..."
                ></textarea>
                <small
                  class="text-muted"
                  th:text="#{modal.complaint.description.help}"
                  >Seja o mais detalhado poss√≠vel para facilitar a
                  an√°lise.</small
                >
              </div>
              <div class="mb-3">
                <label class="form-label" th:text="#{modal.complaint.people}"
                  >Pessoas Envolvidas (opcional)</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="denunciaEnvolvidos"
                  th:attr="placeholder=#{modal.complaint.people.placeholder}"
                  placeholder="Nomes ou cargos das pessoas envolvidas"
                />
              </div>
              <div class="mb-3">
                <label class="form-label" th:text="#{modal.complaint.location}"
                  >Local da Ocorr√™ncia (opcional)</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="denunciaLocal"
                  th:attr="placeholder=#{modal.complaint.location.placeholder}"
                  placeholder="Ex: Escrit√≥rio, Setor X, Sala Y"
                />
              </div>
              <div class="mb-3">
                <label class="form-label" th:text="#{modal.complaint.date}"
                  >Data da Ocorr√™ncia (opcional)</label
                >
                <input
                  type="datetime-local"
                  class="form-control"
                  id="denunciaDataOcorrencia"
                />
              </div>
              <div class="mb-3">
                <label
                  class="form-label"
                  th:text="#{modal.complaint.attachments}"
                  >Anexos (opcional)</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="denunciaAnexos"
                  th:attr="placeholder=#{modal.complaint.attachments.placeholder}"
                  placeholder="URLs ou refer√™ncias de arquivos anexados"
                />
                <small
                  class="text-muted"
                  th:text="#{modal.complaint.attachments.help}"
                  >Por enquanto, cole URLs de arquivos. Em breve, upload direto
                  ser√° disponibilizado.</small
                >
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              th:text="#{dashboard.mood.cancel}"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-danger"
              id="btnSalvarDenuncia"
              th:text="#{modal.complaint.submit}"
            >
              Enviar Den√∫ncia
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Responder Enquete -->
    <div class="modal fade" id="modalResponderEnquete" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Responder Enquete</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="formResponderEnquete">
              <div class="mb-3">
                <label
                  class="form-label fw-bold"
                  id="modalResponderEnquetePergunta"
                ></label>
                <div id="opcoesRespostaContainer"></div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="btnSalvarRespostaEnquete"
            >
              Enviar Resposta
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modais de IA -->
    <!-- Modal Chat IA -->
    <div class="modal fade" id="modalChatIA" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" th:text="#{modal.chat.title}">
              üí¨ Chat Assistente - WorkWell
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body" style="height: 400px; overflow-y: auto">
            <div id="chatMessages" class="mb-3">
              <div class="alert alert-info">
                <strong>Assistente:</strong>
                <span th:text="#{dashboard.ai.chat.description}"
                  >Ol√°! Sou o assistente virtual do WorkWell. Como posso
                  ajud√°-lo hoje com quest√µes de bem-estar, sa√∫de mental ou
                  trabalho?</span
                >
              </div>
            </div>
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                id="chatInput"
                th:attr="placeholder=#{modal.chat.placeholder}"
                placeholder="Digite sua mensagem..."
              />
              <button
                class="btn btn-primary"
                onclick="enviarMensagemChat()"
                th:text="#{modal.chat.send}"
              >
                Enviar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal An√°lise de Sentimentos -->
    <div class="modal fade" id="modalAnaliseSentimento" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-info text-white">
            <h5 class="modal-title" th:text="#{modal.analysis.title}">
              üìä An√°lise de Sentimentos
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="formAnaliseSentimento">
              <div class="mb-3">
                <label class="form-label">Texto/Observa√ß√µes</label>
                <textarea
                  class="form-control"
                  id="analiseTexto"
                  rows="4"
                  placeholder="Descreva como voc√™ est√° se sentindo ou suas observa√ß√µes..."
                ></textarea>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">N√≠vel de Humor (1-10)</label>
                  <input
                    type="number"
                    class="form-control"
                    id="analiseNivelHumor"
                    min="1"
                    max="10"
                    placeholder="1-10"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Setor</label>
                  <input
                    type="text"
                    class="form-control"
                    id="analiseSetor"
                    placeholder="Seu setor"
                  />
                </div>
              </div>
              <button
                type="button"
                class="btn btn-info w-100"
                onclick="processarAnaliseSentimento()"
              >
                Analisar Sentimentos
              </button>
            </form>
            <div id="resultadoAnalise" class="mt-4" style="display: none">
              <hr />
              <h6 class="fw-bold">Resultado da An√°lise:</h6>
              <div id="analiseConteudo"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Sugest√µes de Atividades -->
    <div class="modal fade" id="modalSugestaoAtividade" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title">üí° Sugest√µes de Atividades</h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="formSugestaoAtividade">
              <div class="mb-3">
                <label class="form-label">Perfil do Funcion√°rio</label>
                <input
                  type="text"
                  class="form-control"
                  id="sugestaoPerfil"
                  placeholder="Ex: Desenvolvedor, Analista, Gerente..."
                />
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">N√≠vel de Humor Atual (1-10)</label>
                  <input
                    type="number"
                    class="form-control"
                    id="sugestaoNivelHumor"
                    min="1"
                    max="10"
                    placeholder="1-10"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Setor</label>
                  <input
                    type="text"
                    class="form-control"
                    id="sugestaoSetor"
                    placeholder="Seu setor"
                  />
                </div>
              </div>
              <button
                type="button"
                class="btn btn-success w-100"
                onclick="processarSugestaoAtividade()"
              >
                Obter Sugest√µes
              </button>
            </form>
            <div id="resultadoSugestao" class="mt-4" style="display: none">
              <hr />
              <h6 class="fw-bold">Sugest√µes Personalizadas:</h6>
              <div id="sugestaoConteudo"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Insights RH -->
    <div class="modal fade" id="modalInsightsRH" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-warning text-dark">
            <h5 class="modal-title">üìà Insights Estrat√©gicos - RH</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-4">
              <div
                class="spinner-border text-warning"
                role="status"
                id="insightsSpinner"
              >
                <span class="visually-hidden">Carregando...</span>
              </div>
              <p class="mt-2">${i18n.modal.insights.loading}</p>
            </div>
            <div id="resultadoInsights" style="display: none">
              <div id="insightsConteudo"></div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
      /*<![CDATA[*/
      // Tradu√ß√µes injetadas pelo Thymeleaf
      const i18n = {
        frequency: {
          title:
            /*[[#{dashboard.frequency.title}]]*/ "Sua Frequ√™ncia de Participa√ß√£o",
          progress: /*[[#{dashboard.frequency.progress}]]*/ "Progresso",
          activities:
            /*[[#{dashboard.frequency.activities}]]*/ "atividades e avalia√ß√µes nos √∫ltimos 30 dias",
          loading: /*[[#{dashboard.frequency.loading}]]*/ "Carregando...",
        },
        ai: {
          title: /*[[#{dashboard.ai.title}]]*/ "Assistente de IA - WorkWell",
          beta: /*[[#{dashboard.ai.beta}]]*/ "Beta",
          chat: {
            title: /*[[#{dashboard.ai.chat.title}]]*/ "Chat Assistente",
            description:
              /*[[#{dashboard.ai.chat.description}]]*/ "Converse com nosso assistente virtual",
            button: /*[[#{dashboard.ai.chat.button}]]*/ "Abrir Chat",
          },
          sentiment: {
            title:
              /*[[#{dashboard.ai.sentiment.title}]]*/ "An√°lise de Sentimentos",
            description:
              /*[[#{dashboard.ai.sentiment.description}]]*/ "Analise seus registros",
            button:
              /*[[#{dashboard.ai.sentiment.button}]]*/ "Analisar Sentimentos",
          },
          suggestions: {
            title:
              /*[[#{dashboard.ai.suggestions.title}]]*/ "Sugest√µes de Atividades",
            description:
              /*[[#{dashboard.ai.suggestions.description}]]*/ "Receba sugest√µes",
            button: /*[[#{dashboard.ai.suggestions.button}]]*/ "Ver Sugest√µes",
          },
          insights: {
            title:
              /*[[#{dashboard.ai.insights.title}]]*/ "Insights Estrat√©gicos",
            description:
              /*[[#{dashboard.ai.insights.description}]]*/ "Obtenha insights",
            button: /*[[#{dashboard.ai.insights.button}]]*/ "Gerar Insights",
          },
        },
        agenda: {
          title: /*[[#{dashboard.agenda.title}]]*/ "Agenda de Hoje",
          empty:
            /*[[#{dashboard.agenda.empty}]]*/ "Nenhuma atividade ou consulta agendada para hoje",
          history: {
            title:
              /*[[#{dashboard.agenda.history.title}]]*/ "Hist√≥rico de Participa√ß√£o",
            loading:
              /*[[#{dashboard.agenda.history.loading}]]*/ "Carregando hist√≥rico...",
          },
        },
        modal: {
          chat: {
            title: /*[[#{modal.chat.title}]]*/ "Chat Assistente - WorkWell",
            placeholder:
              /*[[#{modal.chat.placeholder}]]*/ "Digite sua mensagem aqui...",
            send: /*[[#{modal.chat.send}]]*/ "Enviar",
          },
          analysis: {
            title: /*[[#{modal.analysis.title}]]*/ "An√°lise de Sentimentos",
            loading:
              /*[[#{modal.analysis.loading}]]*/ "Analisando seus dados...",
            error:
              /*[[#{modal.analysis.error}]]*/ "Erro ao analisar sentimentos. Tente novamente.",
          },
          insights: {
            title: /*[[#{modal.insights.title}]]*/ "Insights Estrat√©gicos",
            loading: /*[[#{modal.insights.loading}]]*/ "Gerando insights...",
            error:
              /*[[#{modal.insights.error}]]*/ "Erro ao gerar insights. Tente novamente.",
            executive: /*[[#{modal.insights.executive}]]*/ "Resumo Executivo",
            positive: /*[[#{modal.insights.positive}]]*/ "Pontos Positivos",
            critical: /*[[#{modal.insights.critical}]]*/ "Pontos Cr√≠ticos",
            recommendations:
              /*[[#{modal.insights.recommendations}]]*/ "Recomenda√ß√µes",
            trend: /*[[#{modal.insights.trend}]]*/ "Tend√™ncia",
          },
        },
        profile: /*[[#{profile.label}]]*/ "Perfil",
        notification: {
          consultationSoon:
            /*[[#{notification.consultation.soon}]]*/ "Consulta em breve",
          consultationWith:
            /*[[#{notification.consultation.with}]]*/ "Voc√™ tem uma consulta com {0} em {1} minutos",
        },
        frequency: {
          excellent:
            /*[[#{dashboard.frequency.excellent}]]*/ "Bom ritmo! Continue cuidando de si mesmo, voc√™ est√° no caminho certo! üåü",
          good: /*[[#{dashboard.frequency.good}]]*/ "√ìtimo progresso! Voc√™ est√° se dedicando ao seu bem-estar.",
          average:
            /*[[#{dashboard.frequency.average}]]*/ "Continue assim! Cada pequeno passo conta.",
          low: /*[[#{dashboard.frequency.low}]]*/ "Que tal participar de mais atividades? Estamos aqui para apoiar voc√™!",
          progress: /*[[#{dashboard.frequency.progress}]]*/ "Progresso",
          activities:
            /*[[#{dashboard.frequency.activities}]]*/ "atividades e avalia√ß√µes nos √∫ltimos 30 dias",
          loading: /*[[#{dashboard.frequency.loading}]]*/ "Carregando...",
        },
        surveys: {
          title: /*[[#{dashboard.surveys.title}]]*/ "Enquetes R√°pidas",
          answers: /*[[#{dashboard.surveys.answers}]]*/ "resposta(s)",
          participation:
            /*[[#{dashboard.surveys.participation}]]*/ "de participa√ß√£o",
          responded: /*[[#{dashboard.surveys.responded}]]*/ "Voc√™ j√° respondeu",
          respond: /*[[#{dashboard.surveys.respond}]]*/ "Responder",
          loading:
            /*[[#{dashboard.surveys.loading}]]*/ "Carregando enquetes...",
          empty:
            /*[[#{dashboard.surveys.empty}]]*/ "Nenhuma enquete dispon√≠vel no momento.",
        },
        activities: {
          title:
            /*[[#{dashboard.activities.title}]]*/ "Atividades de Bem-Estar",
          typePhysical:
            /*[[#{dashboard.activities.type.physical}]]*/ "Atividade F√≠sica",
          typeMental:
            /*[[#{dashboard.activities.type.mental}]]*/ "Sa√∫de Mental",
          typeSocial: /*[[#{dashboard.activities.type.social}]]*/ "Social",
          typeNutrition:
            /*[[#{dashboard.activities.type.nutrition}]]*/ "Nutri√ß√£o",
          date: /*[[#{dashboard.activities.date}]]*/ "Data",
          location: /*[[#{dashboard.activities.location}]]*/ "Local",
          participants:
            /*[[#{dashboard.activities.participants}]]*/ "participante(s)",
          adherence: /*[[#{dashboard.activities.adherence}]]*/ "de ader√™ncia",
          participate:
            /*[[#{dashboard.activities.participate}]]*/ "Vou participar",
          notParticipate:
            /*[[#{dashboard.activities.not.participate}]]*/ "N√£o vou",
          loading:
            /*[[#{dashboard.activities.loading}]]*/ "Carregando atividades...",
          empty:
            /*[[#{dashboard.activities.empty}]]*/ "Nenhuma atividade dispon√≠vel no momento.",
        },
        evaluations: {
          title:
            /*[[#{dashboard.evaluations.title}]]*/ "Avalia√ß√µes Profundas (NR-1)",
          description:
            /*[[#{dashboard.evaluations.description}]]*/ "Avalia√ß√µes semanais de sa√∫de ocupacional conforme NR-1. Responda √†s avalia√ß√µes dispon√≠veis para contribuir com seu bem-estar.",
          start: /*[[#{dashboard.evaluations.start}]]*/ "In√≠cio",
          end: /*[[#{dashboard.evaluations.end}]]*/ "T√©rmino",
          responded:
            /*[[#{dashboard.evaluations.responded}]]*/ "Voc√™ j√° respondeu esta avalia√ß√£o",
          alreadyResponded:
            /*[[#{dashboard.evaluations.already.responded}]]*/ "J√° Respondida",
          respond:
            /*[[#{dashboard.evaluations.respond}]]*/ "Responder Avalia√ß√£o",
          loading:
            /*[[#{dashboard.evaluations.loading}]]*/ "Carregando avalia√ß√µes...",
          empty:
            /*[[#{dashboard.evaluations.empty}]]*/ "Nenhuma avalia√ß√£o dispon√≠vel no momento.",
          notStarted:
            /*[[#{dashboard.evaluations.not.started}]]*/ "Avalia√ß√£o ainda n√£o iniciada",
          ended: /*[[#{dashboard.evaluations.ended}]]*/ "Avalia√ß√£o encerrada",
        },
        mood: {
          title: /*[[#{dashboard.mood.title}]]*/ "Mood Check",
          description:
            /*[[#{dashboard.mood.description}]]*/ "Registre como voc√™ est√° se sentindo hoje.",
          register: /*[[#{dashboard.mood.register}]]*/ "Registrar Humor",
        },
        support: {
          title: /*[[#{dashboard.support.title}]]*/ "Espa√ßo de Apoio",
          description:
            /*[[#{dashboard.support.description}]]*/ "Acesse recursos de bem-estar e suporte psicol√≥gico.",
          access: /*[[#{dashboard.support.access}]]*/ "Acessar",
        },
        complaints: {
          title:
            /*[[#{dashboard.complaints.title}]]*/ "Canal de Den√∫ncias √âticas",
          description:
            /*[[#{dashboard.complaints.description}]]*/ "Registre den√∫ncias de forma 100% sigilosa e independente da empresa.",
          register:
            /*[[#{dashboard.complaints.register}]]*/ "Registrar Den√∫ncia",
        },
        complaintModal: {
          title: /*[[#{modal.complaint.title}]]*/ "Registrar Den√∫ncia √âtica",
          confidentiality:
            /*[[#{modal.complaint.confidentiality}]]*/ "Confidencialidade Garantida",
          confidentialityText:
            /*[[#{modal.complaint.confidentiality.text}]]*/ "Esta den√∫ncia √© 100% sigilosa e ser√° tratada com total confidencialidade. Seu anonimato ser√° preservado.",
          type: /*[[#{modal.complaint.type}]]*/ "Tipo de Den√∫ncia",
          typeSelect:
            /*[[#{modal.complaint.type.select}]]*/ "Selecione o tipo...",
          description:
            /*[[#{modal.complaint.description}]]*/ "Descri√ß√£o da Den√∫ncia",
          descriptionPlaceholder:
            /*[[#{modal.complaint.description.placeholder}]]*/ "Descreva detalhadamente a situa√ß√£o que voc√™ deseja denunciar...",
          descriptionHelp:
            /*[[#{modal.complaint.description.help}]]*/ "Seja o mais detalhado poss√≠vel para facilitar a an√°lise.",
          people:
            /*[[#{modal.complaint.people}]]*/ "Pessoas Envolvidas (opcional)",
          peoplePlaceholder:
            /*[[#{modal.complaint.people.placeholder}]]*/ "Nomes ou cargos das pessoas envolvidas",
          location:
            /*[[#{modal.complaint.location}]]*/ "Local da Ocorr√™ncia (opcional)",
          locationPlaceholder:
            /*[[#{modal.complaint.location.placeholder}]]*/ "Ex: Escrit√≥rio, Setor X, Sala Y",
          date: /*[[#{modal.complaint.date}]]*/ "Data da Ocorr√™ncia (opcional)",
          attachments:
            /*[[#{modal.complaint.attachments}]]*/ "Anexos (opcional)",
          attachmentsPlaceholder:
            /*[[#{modal.complaint.attachments.placeholder}]]*/ "URLs ou refer√™ncias de arquivos anexados",
          attachmentsHelp:
            /*[[#{modal.complaint.attachments.help}]]*/ "Por enquanto, cole URLs de arquivos. Em breve, upload direto ser√° disponibilizado.",
          submit: /*[[#{modal.complaint.submit}]]*/ "Enviar Den√∫ncia",
        },
        suggestions: {
          title: /*[[#{modal.suggestions.title}]]*/ "Sugest√µes de Atividades",
          loading: /*[[#{modal.suggestions.loading}]]*/ "Gerando sugest√µes...",
          error:
            /*[[#{modal.suggestions.error}]]*/ "Erro ao gerar sugest√µes. Tente novamente.",
        },
        assistant: {
          thinking: /*[[#{assistant.thinking}]]*/ "Pensando...",
          you: /*[[#{assistant.you}]]*/ "Voc√™",
          error:
            /*[[#{assistant.error}]]*/ "Erro ao enviar mensagem. Tente novamente.",
        },
        general: {
          loading: /*[[#{general.loading}]]*/ "Carregando...",
          close: /*[[#{general.close}]]*/ "Fechar",
          save: /*[[#{general.save}]]*/ "Salvar",
          cancel: /*[[#{general.cancel}]]*/ "Cancelar",
          confirm: /*[[#{general.confirm}]]*/ "Confirmar",
          conclude: /*[[#{general.conclude}]]*/ "Concluir",
          start: /*[[#{general.start}]]*/ "In√≠cio",
          end: /*[[#{general.end}]]*/ "Fim",
          active: /*[[#{general.active}]]*/ "Ativa",
          inactive: /*[[#{general.inactive}]]*/ "Inativa",
          from: /*[[#{general.from}]]*/ "de",
          employee: /*[[#{general.employee}]]*/ "Funcion√°rio",
          observations: /*[[#{general.observations}]]*/ "Observa√ß√µes",
          date: /*[[#{general.date}]]*/ "Data",
          period: /*[[#{general.period}]]*/ "Per√≠odo",
          responses: /*[[#{general.responses}]]*/ "Respostas",
          noPending:
            /*[[#{general.no.pending}]]*/ "Nenhuma solicita√ß√£o pendente",
        },
        action: {
          save: /*[[#{action.save}]]*/ "Salvar",
          cancel: /*[[#{action.cancel}]]*/ "Cancelar",
          conclude: /*[[#{action.conclude}]]*/ "Concluir",
          back: /*[[#{action.back}]]*/ "Voltar",
          summarize: /*[[#{action.summarize}]]*/ "Resumir",
          viewReport: /*[[#{action.view.report}]]*/ "Ver Relat√≥rio",
          viewConfidentialReport:
            /*[[#{action.view.confidential.report}]]*/ "Ver Relat√≥rio Confidencial",
          openLink: /*[[#{action.open.link}]]*/ "Abrir link",
        },
      };
      /*]]>*/

      const token = localStorage.getItem("token");
      const userRole = localStorage.getItem("userRole");

      if (!token) {
        window.location.href = "/login";
      }

      document.getElementById("userInfo").textContent = `${i18n.profile}: ${
        userRole || "Usu√°rio"
      }`;

      // Configurar se√ß√µes para ADMIN
      if (userRole === "ADMIN") {
        // Ocultar todas as se√ß√µes padr√£o
        document.getElementById("notificacoesContainer").style.display = "none";
        document.getElementById("secaoTituloSaudacao").style.display = "none";
        document.getElementById("secaoFrequencia").style.display = "none";
        document.getElementById("secaoAgenda").style.display = "none";
        document.getElementById("secaoHistorico").style.display = "none";
        document.getElementById("cardMoodCheck").style.display = "none";
        document.getElementById("cardDashboardRh").style.display = "none";
        document.getElementById("cardEspacoApoio").style.display = "none";
        document.getElementById("secaoEnquetesRapidas").style.display = "none";
        document.getElementById("secaoAtividadesBemEstar").style.display =
          "none";
        document.getElementById("secaoAvaliacoesProfundas").style.display =
          "none";
        document.getElementById("avaliacoesProfundasContainer").style.display =
          "none";
        document.getElementById("secaoMinhasAvaliacoes").style.display = "none";
        document.getElementById(
          "secaoAvaliacoesProfundasFuncionario"
        ).style.display = "none";

        // Mostrar apenas Canal de Den√∫ncias √âticas
        document.getElementById("secaoCanalDenuncias").style.display = "block";
        carregarDenunciasEticas();
      } else if (userRole === "PSICOLOGO") {
        // Ocultar se√ß√µes de funcion√°rio
        document.getElementById("notificacoesContainer").style.display = "none";
        document.getElementById("secaoTituloSaudacao").style.display = "none";
        document.getElementById("secaoFrequencia").style.display = "none";
        document.getElementById("secaoAgenda").style.display = "none";
        document.getElementById("secaoHistorico").style.display = "none";
        document.getElementById("cardMoodCheck").style.display = "none";
        document.getElementById("cardDashboardRh").style.display = "none";
        document.getElementById("secaoEnquetesRapidas").style.display = "none";
        document.getElementById("secaoAtividadesBemEstar").style.display =
          "none";

        // Mostrar se√ß√µes de avalia√ß√µes profundas
        document.getElementById("secaoAvaliacoesProfundas").style.display =
          "block";
        document.getElementById("avaliacoesProfundasContainer").style.display =
          "block";
        document.getElementById("secaoMinhasAvaliacoes").style.display =
          "block";
      } else if (userRole === "FUNCIONARIO") {
        // Mostrar se√ß√µes para funcion√°rios
        document.getElementById("secaoEnquetesRapidas").style.display = "block";
        document.getElementById("secaoAtividadesBemEstar").style.display =
          "block";
        document.getElementById(
          "secaoAvaliacoesProfundasFuncionario"
        ).style.display = "block";
        document.getElementById("cardDenunciaEtica").style.display = "block";

        // Mostrar se√ß√£o de IA para funcion√°rio
        document.getElementById("secaoIA").style.display = "block";
        document.getElementById("cardAnaliseSentimento").style.display =
          "block";
        document.getElementById("cardSugestaoAtividade").style.display =
          "block";

        carregarEnquetesRapidas();
        carregarAtividadesBemEstar();
        carregarAvaliacoesProfundasFuncionario();
      } else if (userRole === "RH") {
        // Mostrar card do Dashboard RH APENAS para RH
        document.getElementById("cardDashboardRh").style.display = "block";
        // Mostrar se√ß√£o de IA para RH
        document.getElementById("secaoIA").style.display = "block";
        document.getElementById("cardAnaliseSentimento").style.display =
          "block";
        document.getElementById("cardInsightsRH").style.display = "block";
      }

      document.getElementById("btnLogout").addEventListener("click", () => {
        localStorage.removeItem("token");
        localStorage.removeItem("userRole");
        window.location.href = "/login";
      });

      // Fun√ß√£o para fazer requisi√ß√µes autenticadas
      async function apiRequest(url, options = {}) {
        const defaultOptions = {
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
        };
        const response = await fetch(url, { ...defaultOptions, ...options });
        if (response.status === 401) {
          localStorage.removeItem("token");
          localStorage.removeItem("userRole");
          window.location.href = "/login";
        }
        return response;
      }

      // Formatar data/hora no fuso hor√°rio de S√£o Paulo
      function formatarDataHora(dataHora) {
        const date = new Date(dataHora);
        // Converter para timezone de S√£o Paulo (America/Sao_Paulo)
        const options = {
          timeZone: "America/Sao_Paulo",
          day: "2-digit",
          month: "2-digit",
          year: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        };
        return date.toLocaleString("pt-BR", options);
      }

      function formatarTempoRestante(minutos) {
        if (minutos < 0) return "J√° passou";
        if (minutos < 60) return `${minutos} min`;
        const horas = Math.floor(minutos / 60);
        const mins = minutos % 60;
        return mins > 0 ? `${horas}h ${mins}min` : `${horas}h`;
      }

      function obterNomeTipo(tipo) {
        const tipos = {
          ATIVIDADE_FISICA: "Atividade F√≠sica",
          HAPPY_HOUR: "Happy Hour",
          PALESTRA_BEM_ESTAR: "Palestra",
          MEDITACAO_GUIADA: "Medita√ß√£o",
          INTERACAO_SOCIAL: "Intera√ß√£o Social",
          SESSAO_ANTI_BURNOUT: "Anti-Burnout",
        };
        return tipos[tipo] || tipo;
      }

      // Carregar Frequ√™ncia
      async function carregarFrequencia() {
        try {
          const response = await apiRequest(
            "/api/dashboard-rh/funcionario/frequencia"
          );
          if (response.ok) {
            const data = await response.json();
            const percentual = Math.round(data.percentualFrequencia);

            document.getElementById(
              "percentualFrequencia"
            ).textContent = `${percentual}%`;
            document.getElementById(
              "percentualGrande"
            ).textContent = `${percentual}%`;
            document.getElementById(
              "barraFrequencia"
            ).style.width = `${percentual}%`;
            document
              .getElementById("barraFrequencia")
              .setAttribute("aria-valuenow", percentual);
            document.getElementById("mensagemMotivacional").textContent =
              data.mensagemMotivacional;
            document.getElementById("atividadesParticipadas").textContent =
              data.atividadesParticipadas;
            document.getElementById("totalAtividades").textContent =
              data.totalAtividades;

            // Atualizar cor do card
            const card = document.getElementById("frequenciaCard");
            card.className = `card shadow-sm border-0 frequencia-card ${data.corBarra}`;
          }
        } catch (error) {
          console.error("Erro ao carregar frequ√™ncia:", error);
        }
      }

      // Carregar Agenda do Dia
      async function carregarAgenda() {
        try {
          const response = await apiRequest(
            "/api/dashboard-rh/funcionario/agenda"
          );
          if (response.ok) {
            const data = await response.json();
            const container = document.getElementById("agendaContainer");
            const total = data.atividades.length + data.consultas.length;
            document.getElementById("totalAgenda").textContent = total;

            if (total === 0) {
              container.innerHTML = `
                <div class="text-center text-muted py-4">
                  <p class="mb-0">${i18n.agenda.empty}</p>
                </div>
              `;
              return;
            }

            let html = "";

            // Atividades
            data.atividades.forEach((atividade) => {
              const tempoRestante = formatarTempoRestante(
                atividade.minutosRestantes
              );
              const statusBadge = atividade.vaiParticipar
                ? '<span class="badge bg-success">Confirmado</span>'
                : atividade.vaiParticipar === false
                ? '<span class="badge bg-secondary">N√£o participar√°</span>'
                : '<span class="badge bg-warning">N√£o confirmado</span>';

              html += `
                <div class="agenda-item card mb-3 border-start border-4 border-primary">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                      <div class="flex-grow-1">
                        <div class="d-flex align-items-center gap-2 mb-2">
                          <h6 class="mb-0 fw-bold">${atividade.titulo}</h6>
                          ${statusBadge}
                        </div>
                        <p class="text-muted small mb-2">${obterNomeTipo(
                          atividade.tipo
                        )}</p>
                        ${
                          atividade.descricao
                            ? `<p class="small mb-2">${atividade.descricao}</p>`
                            : ""
                        }
                        <div class="d-flex gap-3 text-muted small">
                          <span>üïê ${formatarDataHora(
                            atividade.dataHoraInicio
                          )}</span>
                          ${
                            atividade.local
                              ? `<span>üìç ${atividade.local}</span>`
                              : ""
                          }
                          ${
                            atividade.minutosRestantes > 0
                              ? `<span>‚è±Ô∏è ${tempoRestante}</span>`
                              : ""
                          }
                        </div>
                      </div>
                      ${
                        atividade.vaiParticipar === null
                          ? `
                        <div>
                          <button class="btn btn-sm btn-primary" onclick="participarAtividade('${atividade.id}', true)">
                            Participar
                          </button>
                        </div>
                      `
                          : ""
                      }
                    </div>
                  </div>
                </div>
              `;
            });

            // Consultas
            data.consultas.forEach((consulta) => {
              // Calcular tempo restante (as datas j√° v√™m do backend no timezone de S√£o Paulo)
              const dataConsulta = new Date(consulta.dataHoraInicio);
              const agora = new Date();
              const tempoRestante = formatarTempoRestante(
                Math.floor((dataConsulta - agora) / 60000)
              );
              const statusBadge =
                consulta.status === "CONFIRMADA"
                  ? '<span class="badge bg-success">Confirmada</span>'
                  : '<span class="badge bg-warning">Pendente</span>';

              html += `
                <div class="agenda-item card mb-3 border-start border-4 border-info">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                      <div class="flex-grow-1">
                        <div class="d-flex align-items-center gap-2 mb-2">
                          <h6 class="mb-0 fw-bold">Consulta Psicol√≥gica</h6>
                          ${statusBadge}
                        </div>
                        <p class="text-muted small mb-2">Com ${
                          consulta.psicologoNome
                        }</p>
                        <div class="d-flex gap-3 text-muted small">
                          <span>üïê ${formatarDataHora(
                            consulta.dataHoraInicio
                          )}</span>
                          <span>üìç ${consulta.local}</span>
                          ${
                            tempoRestante !== "J√° passou"
                              ? `<span>‚è±Ô∏è ${tempoRestante}</span>`
                              : ""
                          }
                        </div>
                        ${
                          consulta.linkCall
                            ? `
                          <div class="mt-2">
                            <a href="${consulta.linkCall}" target="_blank" class="btn btn-sm btn-outline-primary">
                              Acessar Chamada
                            </a>
                          </div>
                        `
                            : ""
                        }
                      </div>
                    </div>
                  </div>
                </div>
              `;
            });

            container.innerHTML = html;

            // Mostrar notifica√ß√µes
            mostrarNotificacoes(data.notificacoes);
          }
        } catch (error) {
          console.error("Erro ao carregar agenda:", error);
        }
      }

      // Mostrar Notifica√ß√µes
      function mostrarNotificacoes(notificacoes) {
        const container = document.getElementById("notificacoesContainer");
        if (!notificacoes || notificacoes.length === 0) {
          container.innerHTML = "";
          return;
        }

        let html = "";
        notificacoes.forEach((notif) => {
          const alertClass =
            notif.cor === "danger" ? "alert-danger" : "alert-warning";
          html += `
            <div class="alert ${alertClass} alert-dismissible fade show notification-item mb-2 shadow" role="alert">
              <strong>${notif.titulo}</strong><br>
              <small>${notif.mensagem}</small>
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          `;
        });
        container.innerHTML = html;

        // Auto-dismiss ap√≥s 10 segundos
        setTimeout(() => {
          const alerts = container.querySelectorAll(".alert");
          alerts.forEach((alert) => {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          });
        }, 10000);
      }

      // Carregar Hist√≥rico
      async function carregarHistorico() {
        try {
          const response = await apiRequest(
            "/api/dashboard-rh/funcionario/historico"
          );
          if (response.ok) {
            const data = await response.json();
            const container = document.getElementById("historicoContainer");
            document.getElementById("totalHistorico").textContent =
              data.totalParticipacoes;

            if (data.participacoes.length === 0) {
              container.innerHTML = `
                <div class="text-center text-muted py-4">
                  <p class="mb-0">Voc√™ ainda n√£o participou de nenhuma atividade</p>
                </div>
              `;
              return;
            }

            let html =
              '<div class="table-responsive"><table class="table table-hover"><thead><tr><th>Data</th><th>Tipo</th><th>Atividade</th><th>Status</th></tr></thead><tbody>';
            data.participacoes.forEach((part) => {
              const statusBadge = part.participou
                ? '<span class="badge bg-success">Participou</span>'
                : '<span class="badge bg-secondary">N√£o participou</span>';
              html += `
                <tr>
                  <td>${formatarDataHora(part.dataHoraInicio)}</td>
                  <td><span class="badge bg-info tipo-badge">${obterNomeTipo(
                    part.tipo
                  )}</span></td>
                  <td>${part.titulo}</td>
                  <td>${statusBadge}</td>
                </tr>
              `;
            });
            html += "</tbody></table></div>";
            container.innerHTML = html;
          }
        } catch (error) {
          console.error("Erro ao carregar hist√≥rico:", error);
        }
      }

      // Participar de Atividade
      async function participarAtividade(atividadeId, vaiParticipar) {
        try {
          const response = await apiRequest(
            "/api/dashboard-rh/atividades/participar",
            {
              method: "POST",
              body: JSON.stringify({
                atividadeId: atividadeId,
                vaiParticipar: vaiParticipar,
              }),
            }
          );

          if (response.ok) {
            await carregarAgenda();
            await carregarFrequencia();
          } else {
            const error = await response.json();
            alert(
              "Erro: " +
                (error.message || "N√£o foi poss√≠vel confirmar participa√ß√£o")
            );
          }
        } catch (error) {
          console.error("Erro ao participar:", error);
          alert("Erro ao confirmar participa√ß√£o");
        }
      }

      // Registrar humor
      document
        .getElementById("btnRegistrarHumor")
        .addEventListener("click", () => {
          const modal = new bootstrap.Modal(
            document.getElementById("modalRegistrarHumor")
          );
          modal.show();
        });

      // Registrar den√∫ncia √©tica
      document
        .getElementById("btnRegistrarDenuncia")
        ?.addEventListener("click", () => {
          const modal = new bootstrap.Modal(
            document.getElementById("modalRegistrarDenuncia")
          );
          modal.show();
        });

      document
        .getElementById("btnSalvarDenuncia")
        ?.addEventListener("click", async () => {
          const tipo = document.getElementById("denunciaTipo").value;
          const descricao = document.getElementById("denunciaDescricao").value;
          const envolvidos =
            document.getElementById("denunciaEnvolvidos").value;
          const local = document.getElementById("denunciaLocal").value;
          const dataOcorrencia = document.getElementById(
            "denunciaDataOcorrencia"
          ).value;
          const anexos = document.getElementById("denunciaAnexos").value;

          if (!tipo || !descricao) {
            alert(
              "Por favor, preencha pelo menos o tipo e a descri√ß√£o da den√∫ncia"
            );
            return;
          }

          try {
            const body = {
              tipoDenuncia: tipo,
              descricao: descricao,
              envolvidos: envolvidos || null,
              localOcorrencia: local || null,
              dataOcorrencia: dataOcorrencia || null,
              anexos: anexos || null,
            };

            const response = await apiRequest("/api/denuncias-eticas", {
              method: "POST",
              body: JSON.stringify(body),
            });

            if (response.ok) {
              alert(
                "Den√∫ncia registrada com sucesso! Ela ser√° analisada com total confidencialidade."
              );
              const modal = bootstrap.Modal.getInstance(
                document.getElementById("modalRegistrarDenuncia")
              );
              modal.hide();
              document.getElementById("formRegistrarDenuncia").reset();
            } else {
              const error = await response.json();
              alert(
                "Erro: " +
                  (error.message || "N√£o foi poss√≠vel registrar a den√∫ncia")
              );
            }
          } catch (error) {
            console.error("Erro ao registrar den√∫ncia:", error);
            alert("Erro ao registrar den√∫ncia");
          }
        });

      document.getElementById("humorNivel").addEventListener("input", (e) => {
        document.getElementById("humorNivelDisplay").textContent =
          e.target.value;
      });

      document
        .getElementById("btnSalvarHumor")
        .addEventListener("click", async () => {
          const nivel = parseInt(document.getElementById("humorNivel").value);
          const setor = document.getElementById("humorSetor").value;
          const observacoes = document.getElementById("humorObservacoes").value;

          try {
            const response = await apiRequest("/api/dashboard-rh/humor", {
              method: "POST",
              body: JSON.stringify({
                nivelHumor: nivel,
                setor: setor || null,
                observacoes: observacoes || null,
              }),
            });

            if (response.ok) {
              alert("Humor registrado com sucesso! üòä");
              bootstrap.Modal.getInstance(
                document.getElementById("modalRegistrarHumor")
              ).hide();
              document.getElementById("formRegistrarHumor").reset();
              document.getElementById("humorNivelDisplay").textContent = "3";
            } else {
              const error = await response.json();
              alert(
                "Erro: " +
                  (error.message || "N√£o foi poss√≠vel registrar o humor")
              );
            }
          } catch (error) {
            console.error("Erro ao registrar humor:", error);
            alert("Erro ao registrar humor");
          }
        });

      // ========== AVALIA√á√ïES PROFUNDAS ==========
      let avaliacaoAtual = null;

      // Carregar avalia√ß√µes profundas para funcion√°rios
      async function carregarAvaliacoesProfundasFuncionario() {
        if (userRole !== "FUNCIONARIO") return;
        try {
          const response = await apiRequest("/api/avaliacoes-profundas");
          if (response.ok) {
            const avaliacoes = await response.json();
            const container = document.getElementById(
              "avaliacoesProfundasFuncionarioContainer"
            );
            if (!container) return;

            if (avaliacoes.length === 0) {
              container.innerHTML = `
                <div class="col-12">
                  <div class="alert alert-info">
                    Nenhuma avalia√ß√£o profunda dispon√≠vel no momento.
                  </div>
                </div>
              `;
              return;
            }

            const html = avaliacoes
              .map((avaliacao) => {
                const dataInicio = new Date(
                  avaliacao.dataInicio
                ).toLocaleString("pt-BR");
                const dataFim = new Date(avaliacao.dataFim).toLocaleString(
                  "pt-BR"
                );
                const agora = new Date();
                const inicio = new Date(avaliacao.dataInicio);
                const fim = new Date(avaliacao.dataFim);
                const podeResponder =
                  agora >= inicio && agora <= fim && !avaliacao.jaRespondeu;

                return `
                  <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm border-0 h-100">
                      <div class="card-body">
                        <h5 class="card-title">${avaliacao.titulo}</h5>
                        <p class="card-text text-muted small">${
                          avaliacao.descricao || "Sem descri√ß√£o"
                        }</p>
                        <div class="mb-2">
                          <small class="text-muted">
                            <strong>${
                              i18n.evaluations.start
                            }:</strong> ${dataInicio}<br>
                            <strong>${i18n.evaluations.end}:</strong> ${dataFim}
                          </small>
                        </div>
                        ${
                          avaliacao.jaRespondeu
                            ? `<div class="alert alert-success small mb-2">
                                <i class="bi bi-check-circle"></i> ${i18n.evaluations.responded}
                              </div>
                              <button class="btn btn-secondary btn-sm w-100" disabled>
                                ${i18n.evaluations.alreadyResponded}
                              </button>`
                            : podeResponder
                            ? `<button class="btn btn-primary btn-sm w-100" onclick="abrirModalResponderAvaliacao('${avaliacao.id}')">
                                ${i18n.evaluations.respond}
                              </button>`
                            : `<div class="alert alert-warning small mb-2">
                                ${
                                  agora < inicio
                                    ? i18n.evaluations.notStarted
                                    : i18n.evaluations.ended
                                }
                              </div>
                              <button class="btn btn-secondary btn-sm w-100" disabled>
                                Indispon√≠vel
                              </button>`
                        }
                      </div>
                    </div>
                  </div>
                `;
              })
              .join("");
            container.innerHTML = html;
          }
        } catch (error) {
          console.error("Erro ao carregar avalia√ß√µes profundas:", error);
          const container = document.getElementById(
            "avaliacoesProfundasFuncionarioContainer"
          );
          if (container) {
            container.innerHTML = `
              <div class="col-12">
                <div class="alert alert-danger">
                  Erro ao carregar avalia√ß√µes. Tente novamente mais tarde.
                </div>
              </div>
            `;
          }
        }
      }

      // Carregar avalia√ß√µes profundas (psic√≥logo)
      async function carregarAvaliacoesProfundas() {
        if (userRole !== "PSICOLOGO") return;
        try {
          const response = await apiRequest("/api/avaliacoes-profundas");
          if (response.ok) {
            const avaliacoes = await response.json();
            const container = document.getElementById(
              "avaliacoesProfundasContainer"
            );
            if (!container) return;

            if (avaliacoes.length === 0) {
              container.innerHTML = `
                <div class="col-12">
                  <div class="alert alert-info">
                    Nenhuma avalia√ß√£o profunda dispon√≠vel no momento.
                  </div>
                </div>
              `;
              return;
            }

            const html = avaliacoes
              .map((avaliacao) => {
                const dataInicio = new Date(
                  avaliacao.dataInicio
                ).toLocaleString("pt-BR");
                const dataFim = new Date(avaliacao.dataFim).toLocaleString(
                  "pt-BR"
                );

                return `
                  <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm border-0 h-100">
                      <div class="card-body">
                        <h5 class="card-title">${avaliacao.titulo}</h5>
                        <p class="card-text text-muted small">${
                          avaliacao.descricao || "Sem descri√ß√£o"
                        }</p>
                        <div class="mb-2">
                          <small class="text-muted">
                            <strong>${
                              i18n.evaluations.start
                            }:</strong> ${dataInicio}<br>
                            <strong>${i18n.evaluations.end}:</strong> ${dataFim}
                          </small>
                        </div>
                        <div class="mb-2">
                          <small class="text-muted">
                            ${avaliacao.totalRespostas} de ${
                  avaliacao.totalUsuarios
                } respostas
                            (${(avaliacao.taxaResposta * 100).toFixed(1)}%)
                          </small>
                        </div>
                        <button class="btn btn-info btn-sm w-100" onclick="verRelatorio('${
                          avaliacao.id
                        }')">
                          Ver Relat√≥rio
                        </button>
                      </div>
                    </div>
                  </div>
                `;
              })
              .join("");
            container.innerHTML = html;
          }
        } catch (error) {
          console.error("Erro ao carregar avalia√ß√µes profundas:", error);
        }
      }

      // Carregar minhas avalia√ß√µes (psic√≥logo)
      async function carregarMinhasAvaliacoes() {
        if (userRole !== "PSICOLOGO") return;
        try {
          const response = await apiRequest("/api/avaliacoes-profundas/minhas");
          if (response.ok) {
            const avaliacoes = await response.json();
            const container = document.getElementById(
              "minhasAvaliacoesContainer"
            );
            if (!container) return;

            if (avaliacoes.length === 0) {
              container.innerHTML = `
                <div class="col-12">
                  <div class="alert alert-info">
                    Voc√™ ainda n√£o criou nenhuma avalia√ß√£o profunda.
                  </div>
                </div>
              `;
              return;
            }

            const html = avaliacoes
              .map((avaliacao) => {
                const dataInicio = new Date(
                  avaliacao.dataInicio
                ).toLocaleString("pt-BR");
                const dataFim = new Date(avaliacao.dataFim).toLocaleString(
                  "pt-BR"
                );
                const ativa = avaliacao.ativa
                  ? i18n.general.active
                  : i18n.general.inactive;

                return `
                  <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm border-0 h-100">
                      <div class="card-body">
                        <h5 class="card-title">${avaliacao.titulo}</h5>
                        <p class="card-text text-muted small">${
                          avaliacao.descricao || "Sem descri√ß√£o"
                        }</p>
                        <div class="mb-2">
                          <span class="badge ${
                            avaliacao.ativa ? "bg-success" : "bg-secondary"
                          }">${ativa}</span>
                        </div>
                        <div class="mb-2">
                          <small class="text-muted">
                            <strong>${
                              i18n.evaluations.start
                            }:</strong> ${dataInicio}<br>
                            <strong>${i18n.evaluations.end}:</strong> ${dataFim}
                          </small>
                        </div>
                        <div class="mb-2">
                          <small class="text-muted">
                            ${avaliacao.totalRespostas} de ${
                  avaliacao.totalUsuarios
                } respostas
                            (${(avaliacao.taxaResposta * 100).toFixed(1)}%)
                          </small>
                        </div>
                        <button class="btn btn-info btn-sm w-100" onclick="verRelatorio('${
                          avaliacao.id
                        }')">
                          ${i18n.action.viewConfidentialReport}
                        </button>
                      </div>
                    </div>
                  </div>
                `;
              })
              .join("");
            container.innerHTML = html;
          }
        } catch (error) {
          console.error("Erro ao carregar minhas avalia√ß√µes:", error);
        }
      }

      // Criar avalia√ß√£o profunda
      const btnCriarAvaliacaoProfunda = document.getElementById(
        "btnCriarAvaliacaoProfunda"
      );
      if (btnCriarAvaliacaoProfunda) {
        btnCriarAvaliacaoProfunda.addEventListener("click", () => {
          const modal = new bootstrap.Modal(
            document.getElementById("modalCriarAvaliacaoProfunda")
          );
          modal.show();
        });
      }

      // Salvar avalia√ß√£o profunda
      const btnSalvarAvaliacaoProfunda = document.getElementById(
        "btnSalvarAvaliacaoProfunda"
      );
      if (btnSalvarAvaliacaoProfunda) {
        btnSalvarAvaliacaoProfunda.addEventListener("click", async () => {
          const titulo = document.getElementById("avaliacaoTitulo").value;
          const descricao = document.getElementById("avaliacaoDescricao").value;
          const dataInicio = document.getElementById(
            "avaliacaoDataInicio"
          ).value;
          const dataFim = document.getElementById("avaliacaoDataFim").value;

          if (!titulo || !dataInicio || !dataFim) {
            alert("Por favor, preencha os campos obrigat√≥rios");
            return;
          }

          // Coletar perguntas
          const perguntasItems = document.querySelectorAll(".pergunta-item");
          const perguntas = [];
          let perguntaId = 1;

          for (const item of perguntasItems) {
            const texto = item.querySelector(".pergunta-texto").value;
            const tipo = item.querySelector(".pergunta-tipo").value;

            if (!texto || !tipo) {
              alert("Por favor, preencha todas as perguntas");
              return;
            }

            const pergunta = {
              id: perguntaId++,
              pergunta: texto,
              tipo: tipo,
            };

            if (tipo === "ESCOLHA") {
              const opcoes = Array.from(item.querySelectorAll(".opcao-input"))
                .map((input) => input.value)
                .filter((val) => val.trim() !== "");

              if (opcoes.length < 2) {
                alert("Perguntas de escolha devem ter pelo menos 2 op√ß√µes");
                return;
              }
              pergunta.opcoes = opcoes;
            }

            perguntas.push(pergunta);
          }

          if (perguntas.length === 0) {
            alert("Adicione pelo menos uma pergunta");
            return;
          }

          try {
            const body = {
              titulo: titulo,
              descricao: descricao,
              perguntas: perguntas,
              dataInicio: dataInicio,
              dataFim: dataFim,
            };

            const response = await apiRequest("/api/avaliacoes-profundas", {
              method: "POST",
              body: JSON.stringify(body),
            });

            if (response.ok) {
              alert("Avalia√ß√£o criada com sucesso!");
              const modal = bootstrap.Modal.getInstance(
                document.getElementById("modalCriarAvaliacaoProfunda")
              );
              modal.hide();
              document.getElementById("formCriarAvaliacaoProfunda").reset();
              document.getElementById("perguntasContainer").innerHTML = `
                <div class="card mb-3 pergunta-item">
                  <div class="card-body">
                    <div class="row mb-2">
                      <div class="col-md-8">
                        <input type="text" class="form-control pergunta-texto" placeholder="Digite a pergunta..." required />
                      </div>
                      <div class="col-md-4">
                        <select class="form-select pergunta-tipo" required>
                          <option value="TEXTO">Texto Livre</option>
                          <option value="NUMERICO">Num√©rico (1-10)</option>
                          <option value="ESCOLHA">Escolha √önica</option>
                        </select>
                      </div>
                    </div>
                    <div class="opcoes-escolha" style="display: none">
                      <label class="form-label small">Op√ß√µes de Resposta</label>
                      <div class="opcoes-container">
                        <div class="input-group mb-2">
                          <input type="text" class="form-control opcao-input" placeholder="Op√ß√£o 1" />
                          <button type="button" class="btn btn-outline-danger btn-sm" onclick="removerOpcaoEscolha(this)">Remover</button>
                        </div>
                      </div>
                      <button type="button" class="btn btn-sm btn-outline-primary" onclick="adicionarOpcaoEscolha(this)">+ Adicionar Op√ß√£o</button>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="removerPergunta(this)">Remover Pergunta</button>
                  </div>
                </div>
              `;
              carregarAvaliacoesProfundas();
              carregarMinhasAvaliacoes();
            } else {
              const error = await response.json();
              alert(
                "Erro: " +
                  (error.message || "N√£o foi poss√≠vel criar a avalia√ß√£o")
              );
            }
          } catch (error) {
            console.error("Erro ao criar avalia√ß√£o:", error);
            alert("Erro ao criar avalia√ß√£o");
          }
        });
      }

      // Ver relat√≥rio
      window.verRelatorio = async function (avaliacaoId) {
        try {
          const response = await apiRequest(
            `/api/avaliacoes-profundas/${avaliacaoId}/relatorio`
          );
          if (response.ok) {
            const relatorio = await response.json();
            document.getElementById(
              "modalRelatorioTitulo"
            ).textContent = `Relat√≥rio: ${relatorio.titulo}`;

            const container = document.getElementById("relatorioContainer");
            container.innerHTML = `
              <div class="mb-4">
                <h6>Informa√ß√µes Gerais</h6>
                <p class="text-muted">${
                  relatorio.descricao || "Sem descri√ß√£o"
                }</p>
                <p><strong>Per√≠odo:</strong> ${new Date(
                  relatorio.dataInicio
                ).toLocaleString("pt-BR")} at√© ${new Date(
              relatorio.dataFim
            ).toLocaleString("pt-BR")}</p>
                <p><strong>Total de Respostas:</strong> ${
                  relatorio.totalRespostas
                } de ${relatorio.totalUsuarios} funcion√°rios (${(
              relatorio.taxaResposta * 100
            ).toFixed(1)}%)</p>
              </div>
              
              <div class="mb-4">
                <h6>Respostas Detalhadas</h6>
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>Funcion√°rio</th>
                        <th>Email</th>
                        <th>Respostas</th>
                        <th>Observa√ß√µes</th>
                        <th>Data</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${relatorio.respostasDetalhadas
                        .map(
                          (r) => `
                        <tr>
                          <td>${r.nomeUsuario}</td>
                          <td>${r.emailUsuario}</td>
                          <td><pre class="small">${JSON.stringify(
                            r.respostas,
                            null,
                            2
                          )}</pre></td>
                          <td>${r.observacoes || "-"}</td>
                          <td>${new Date(r.createdAt).toLocaleString(
                            "pt-BR"
                          )}</td>
                        </tr>
                      `
                        )
                        .join("")}
                    </tbody>
                  </table>
                </div>
              </div>
              
              ${
                relatorio.analiseEstatistica
                  ? `
                <div class="mb-4">
                  <h6>An√°lise Estat√≠stica</h6>
                  <pre class="bg-light p-3 rounded">${JSON.stringify(
                    relatorio.analiseEstatistica,
                    null,
                    2
                  )}</pre>
                </div>
              `
                  : ""
              }
            `;

            const modal = new bootstrap.Modal(
              document.getElementById("modalVerRelatorio")
            );
            modal.show();
          } else {
            const error = await response.json();
            alert(
              "Erro: " +
                (error.message || "N√£o foi poss√≠vel carregar o relat√≥rio")
            );
          }
        } catch (error) {
          console.error("Erro ao carregar relat√≥rio:", error);
          alert("Erro ao carregar relat√≥rio");
        }
      };

      // Fun√ß√µes auxiliares para gerenciar perguntas
      window.adicionarPergunta = function () {
        const container = document.getElementById("perguntasContainer");
        const div = document.createElement("div");
        div.className = "card mb-3 pergunta-item";
        div.innerHTML = `
          <div class="card-body">
            <div class="row mb-2">
              <div class="col-md-8">
                <input type="text" class="form-control pergunta-texto" placeholder="Digite a pergunta..." required />
              </div>
              <div class="col-md-4">
                <select class="form-select pergunta-tipo" required onchange="toggleOpcoesEscolha(this)">
                  <option value="TEXTO">Texto Livre</option>
                  <option value="NUMERICO">Num√©rico (1-10)</option>
                  <option value="ESCOLHA">Escolha √önica</option>
                </select>
              </div>
            </div>
            <div class="opcoes-escolha" style="display: none">
              <label class="form-label small">Op√ß√µes de Resposta</label>
              <div class="opcoes-container">
                <div class="input-group mb-2">
                  <input type="text" class="form-control opcao-input" placeholder="Op√ß√£o 1" />
                  <button type="button" class="btn btn-outline-danger btn-sm" onclick="removerOpcaoEscolha(this)">Remover</button>
                </div>
              </div>
              <button type="button" class="btn btn-sm btn-outline-primary" onclick="adicionarOpcaoEscolha(this)">+ Adicionar Op√ß√£o</button>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="removerPergunta(this)">Remover Pergunta</button>
          </div>
        `;
        container.appendChild(div);
      };

      window.removerPergunta = function (btn) {
        const container = document.getElementById("perguntasContainer");
        if (container.children.length > 1) {
          btn.closest(".pergunta-item").remove();
        } else {
          alert("Voc√™ precisa ter pelo menos uma pergunta");
        }
      };

      window.toggleOpcoesEscolha = function (select) {
        const item = select.closest(".pergunta-item");
        const opcoesDiv = item.querySelector(".opcoes-escolha");
        if (select.value === "ESCOLHA") {
          opcoesDiv.style.display = "block";
        } else {
          opcoesDiv.style.display = "none";
        }
      };

      window.adicionarOpcaoEscolha = function (btn) {
        const container = btn.previousElementSibling;
        const div = document.createElement("div");
        div.className = "input-group mb-2";
        div.innerHTML = `
          <input type="text" class="form-control opcao-input" placeholder="Nova op√ß√£o" />
          <button type="button" class="btn btn-outline-danger btn-sm" onclick="removerOpcaoEscolha(this)">Remover</button>
        `;
        container.appendChild(div);
      };

      window.removerOpcaoEscolha = function (btn) {
        const container = btn.closest(".opcoes-container");
        if (container.children.length > 1) {
          btn.closest(".input-group").remove();
        } else {
          alert("Voc√™ precisa ter pelo menos uma op√ß√£o");
        }
      };

      // Abrir modal para responder avalia√ß√£o
      window.abrirModalResponderAvaliacao = async function (avaliacaoId) {
        try {
          const response = await apiRequest("/api/avaliacoes-profundas");
          if (response.ok) {
            const avaliacoes = await response.json();
            const avaliacao = avaliacoes.find((a) => a.id === avaliacaoId);

            if (!avaliacao) {
              alert("Avalia√ß√£o n√£o encontrada");
              return;
            }

            avaliacaoAtual = avaliacao;
            document.getElementById(
              "modalResponderAvaliacaoTitulo"
            ).textContent = avaliacao.titulo;
            document.getElementById(
              "modalResponderAvaliacaoDescricao"
            ).textContent = avaliacao.descricao || "";

            // Criar campos de resposta
            const container = document.getElementById("respostasContainer");
            container.innerHTML = avaliacao.perguntas
              .map((pergunta, index) => {
                let inputHtml = "";

                if (pergunta.tipo === "TEXTO") {
                  inputHtml = `<textarea class="form-control" id="resposta_${pergunta.id}" rows="3" required></textarea>`;
                } else if (pergunta.tipo === "NUMERICO") {
                  inputHtml = `<input type="number" class="form-control" id="resposta_${pergunta.id}" min="1" max="10" required />`;
                } else if (pergunta.tipo === "ESCOLHA") {
                  const opcoes = pergunta.opcoes || [];
                  inputHtml = `<select class="form-select" id="resposta_${
                    pergunta.id
                  }" required>
                  <option value="">Selecione...</option>
                  ${opcoes
                    .map((op) => `<option value="${op}">${op}</option>`)
                    .join("")}
                </select>`;
                }

                return `
                <div class="mb-3">
                  <label class="form-label"><strong>${pergunta.pergunta}</strong></label>
                  ${inputHtml}
                </div>
              `;
              })
              .join("");

            const modal = new bootstrap.Modal(
              document.getElementById("modalResponderAvaliacaoProfunda")
            );
            modal.show();
          }
        } catch (error) {
          console.error("Erro ao abrir modal de resposta:", error);
          alert("Erro ao carregar avalia√ß√£o");
        }
      };

      // Salvar resposta da avalia√ß√£o
      const btnSalvarRespostaAvaliacaoProfunda = document.getElementById(
        "btnSalvarRespostaAvaliacaoProfunda"
      );
      if (btnSalvarRespostaAvaliacaoProfunda) {
        btnSalvarRespostaAvaliacaoProfunda.addEventListener(
          "click",
          async () => {
            if (!avaliacaoAtual) return;

            const respostas = {};
            avaliacaoAtual.perguntas.forEach((pergunta) => {
              const input = document.getElementById(`resposta_${pergunta.id}`);
              if (input) {
                respostas[pergunta.id] = input.value;
              }
            });

            const observacoes = document.getElementById(
              "avaliacaoObservacoes"
            ).value;

            try {
              const body = {
                avaliacaoId: avaliacaoAtual.id,
                respostas: respostas,
                observacoes: observacoes,
              };

              const response = await apiRequest(
                "/api/avaliacoes-profundas/responder",
                {
                  method: "POST",
                  body: JSON.stringify(body),
                }
              );

              if (response.ok) {
                alert("Respostas enviadas com sucesso!");
                const modal = bootstrap.Modal.getInstance(
                  document.getElementById("modalResponderAvaliacaoProfunda")
                );
                modal.hide();
                if (userRole === "FUNCIONARIO") {
                  carregarAvaliacoesProfundasFuncionario();
                } else {
                  carregarAvaliacoesProfundas();
                }
              } else {
                const error = await response.json();
                alert(
                  "Erro: " +
                    (error.message || "N√£o foi poss√≠vel enviar as respostas")
                );
              }
            } catch (error) {
              console.error("Erro ao enviar respostas:", error);
              alert("Erro ao enviar respostas");
            }
          }
        );
      }

      // ========== ENQUETES R√ÅPIDAS ==========
      let enqueteAtual = null;

      // Carregar enquetes r√°pidas
      async function carregarEnquetesRapidas() {
        if (userRole !== "FUNCIONARIO") return;
        try {
          const response = await apiRequest("/api/dashboard-rh/enquetes");
          if (response.ok) {
            const enquetes = await response.json();
            const container = document.getElementById(
              "enquetesRapidasContainer"
            );
            if (!container) return;

            if (enquetes.length === 0) {
              container.innerHTML = `
                <div class="col-12">
                  <div class="text-center text-muted py-4">
                    <p class="mb-0">${i18n.surveys.empty}</p>
                  </div>
                </div>
              `;
              return;
            }

            const html = enquetes
              .map((enquete) => {
                const jaRespondeu = enquete.jaRespondeu;

                return `
                  <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm border-0 h-100">
                      <div class="card-body">
                        <h6 class="card-title">${enquete.pergunta}</h6>
                        <p class="text-muted small mb-2">
                          ${enquete.totalRespostas || 0} ${
                  i18n.surveys.answers
                } - ${((enquete.taxaResposta || 0) * 100).toFixed(1)}% ${
                  i18n.surveys.participation
                }
                        </p>
                        ${
                          jaRespondeu
                            ? `<span class="badge bg-success mb-2">${i18n.surveys.responded}</span>`
                            : `<button class="btn btn-primary btn-sm mb-2" onclick="abrirModalResponderEnquete('${enquete.id}')">${i18n.surveys.respond}</button>`
                        }
                      </div>
                    </div>
                  </div>
                `;
              })
              .join("");
            container.innerHTML = html;
          }
        } catch (error) {
          console.error("Erro ao carregar enquetes:", error);
          const container = document.getElementById("enquetesRapidasContainer");
          if (container) {
            container.innerHTML = `
              <div class="col-12">
                <div class="alert alert-danger">
                  Erro ao carregar enquetes. Tente novamente mais tarde.
                </div>
              </div>
            `;
          }
        }
      }

      // Abrir modal para responder enquete
      window.abrirModalResponderEnquete = async function (enqueteId) {
        try {
          const response = await apiRequest("/api/dashboard-rh/enquetes");
          if (response.ok) {
            const enquetes = await response.json();
            enqueteAtual = enquetes.find((e) => e.id === enqueteId);

            if (!enqueteAtual) {
              alert("Enquete n√£o encontrada");
              return;
            }

            // Preencher modal
            document.getElementById(
              "modalResponderEnquetePergunta"
            ).textContent = enqueteAtual.pergunta;

            // Limpar e preencher op√ß√µes
            const container = document.getElementById(
              "opcoesRespostaContainer"
            );
            container.innerHTML = "";

            const opcoes = enqueteAtual.opcoesResposta || [
              "SIM",
              "N√ÉO",
              "TALVEZ",
            ];
            opcoes.forEach((opcao) => {
              const div = document.createElement("div");
              div.className = "form-check mb-2";
              div.innerHTML = `
                <input class="form-check-input" type="radio" name="respostaEnquete" id="opcao_${opcao}" value="${opcao}" required>
                <label class="form-check-label" for="opcao_${opcao}">
                  ${opcao}
                </label>
              `;
              container.appendChild(div);
            });

            // Abrir modal
            const modal = new bootstrap.Modal(
              document.getElementById("modalResponderEnquete")
            );
            modal.show();
          }
        } catch (error) {
          console.error("Erro ao carregar enquete:", error);
          alert("Erro ao carregar enquete");
        }
      };

      // Salvar resposta da enquete
      const btnSalvarRespostaEnquete = document.getElementById(
        "btnSalvarRespostaEnquete"
      );
      if (btnSalvarRespostaEnquete) {
        btnSalvarRespostaEnquete.addEventListener("click", async () => {
          if (!enqueteAtual) return;

          const respostaSelecionada = document.querySelector(
            'input[name="respostaEnquete"]:checked'
          );
          if (!respostaSelecionada) {
            alert("Por favor, selecione uma op√ß√£o");
            return;
          }

          const resposta = respostaSelecionada.value;

          try {
            const response = await apiRequest(
              "/api/dashboard-rh/enquetes/responder",
              {
                method: "POST",
                body: JSON.stringify({
                  enqueteId: enqueteAtual.id,
                  resposta: resposta,
                }),
              }
            );

            if (response.ok) {
              alert("Resposta registrada com sucesso!");
              const modal = bootstrap.Modal.getInstance(
                document.getElementById("modalResponderEnquete")
              );
              modal.hide();
              carregarEnquetesRapidas();
            } else {
              const error = await response.json();
              alert(
                "Erro: " +
                  (error.message || "N√£o foi poss√≠vel registrar a resposta")
              );
            }
          } catch (error) {
            console.error("Erro ao responder enquete:", error);
            alert("Erro ao registrar resposta");
          }
        });
      }

      // ========== ATIVIDADES DE BEM-ESTAR ==========
      // Carregar atividades de bem-estar
      async function carregarAtividadesBemEstar() {
        if (userRole !== "FUNCIONARIO") return;
        try {
          const response = await apiRequest("/api/dashboard-rh/atividades");
          if (response.ok) {
            const atividades = await response.json();
            const container = document.getElementById(
              "atividadesBemEstarContainer"
            );
            if (!container) return;

            if (atividades.length === 0) {
              container.innerHTML = `
                <div class="col-12">
                  <div class="text-center text-muted py-4">
                    <p class="mb-0">${i18n.agenda.empty}</p>
                  </div>
                </div>
              `;
              return;
            }

            const tipoLabels = {
              ATIVIDADE_FISICA: "Atividade F√≠sica",
              HAPPY_HOUR: "Happy Hour",
              PALESTRA_BEM_ESTAR: "Palestra de Bem-Estar",
              MEDITACAO_GUIADA: "Medita√ß√£o Guiada",
              INTERACAO_SOCIAL: "Intera√ß√£o Social",
              SESSAO_ANTI_BURNOUT: "Sess√£o Anti-Burnout",
            };

            const html = atividades
              .map((atividade) => {
                const jaParticipou = atividade.jaParticipou;
                const taxaParticipacao = (
                  (atividade.taxaParticipacao || 0) * 100
                ).toFixed(1);
                const dataInicio = formatarDataHora(atividade.dataHoraInicio);

                return `
                  <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm border-0 h-100">
                      <div class="card-body">
                        <span class="badge bg-secondary mb-2">${
                          tipoLabels[atividade.tipo] || atividade.tipo
                        }</span>
                        <h6 class="card-title">${atividade.titulo}</h6>
                        ${
                          atividade.descricao
                            ? `<p class="text-muted small">${atividade.descricao}</p>`
                            : ""
                        }
                        <p class="small mb-2">
                          <strong>${
                            i18n.activities.date
                          }:</strong> ${dataInicio}<br>
                          ${
                            atividade.local
                              ? `<strong>${i18n.activities.location}:</strong> ${atividade.local}`
                              : ""
                          }
                        </p>
                        <p class="text-muted small mb-2">
                          ${atividade.totalParticipantes || 0} ${
                  i18n.activities.participants
                } - ${taxaParticipacao}% ${i18n.activities.adherence}
                        </p>
                        ${
                          jaParticipou
                            ? atividade.vaiParticipar === true
                              ? `<span class="badge bg-success me-2">${i18n.activities.participate}</span><button class="btn btn-outline-danger btn-sm" onclick="participarAtividadeBemEstar('${atividade.id}', false)">${i18n.activities.notParticipate}</button>`
                              : atividade.vaiParticipar === false
                              ? `<span class="badge bg-danger me-2">${i18n.activities.notParticipate}</span><button class="btn btn-outline-success btn-sm" onclick="participarAtividadeBemEstar('${atividade.id}', true)">${i18n.activities.participate}</button>`
                              : '<span class="badge bg-secondary">Registrado</span>'
                            : `<div class="d-flex gap-2"><button class="btn btn-success btn-sm" onclick="participarAtividadeBemEstar('${atividade.id}', true)">${i18n.activities.participate}</button><button class="btn btn-danger btn-sm" onclick="participarAtividadeBemEstar('${atividade.id}', false)">${i18n.activities.notParticipate}</button></div>`
                        }
                      </div>
                    </div>
                  </div>
                `;
              })
              .join("");
            container.innerHTML = html;
          }
        } catch (error) {
          console.error("Erro ao carregar atividades:", error);
          const container = document.getElementById(
            "atividadesBemEstarContainer"
          );
          if (container) {
            container.innerHTML = `
              <div class="col-12">
                <div class="alert alert-danger">
                  Erro ao carregar atividades. Tente novamente mais tarde.
                </div>
              </div>
            `;
          }
        }
      }

      // Participar de atividade de bem-estar
      window.participarAtividadeBemEstar = async function (
        atividadeId,
        vaiParticipar
      ) {
        try {
          const response = await apiRequest(
            "/api/dashboard-rh/atividades/participar",
            {
              method: "POST",
              body: JSON.stringify({
                atividadeId: atividadeId,
                vaiParticipar: vaiParticipar,
              }),
            }
          );

          if (response.ok) {
            const mensagem = vaiParticipar
              ? "Voc√™ confirmou que vai participar!"
              : "Voc√™ informou que n√£o vai participar.";
            alert(mensagem);
            carregarAtividadesBemEstar();
            carregarFrequencia();
            carregarAgenda();
          } else {
            const error = await response.json();
            alert(
              "Erro: " +
                (error.message || "N√£o foi poss√≠vel registrar a participa√ß√£o")
            );
          }
        } catch (error) {
          console.error("Erro ao participar atividade:", error);
          alert("Erro ao registrar participa√ß√£o");
        }
      };

      // ========== CANAL DE DEN√öNCIAS √âTICAS ==========
      // Carregar den√∫ncias √©ticas (ADMIN)
      async function carregarDenunciasEticas() {
        if (userRole !== "ADMIN") return;
        try {
          // Carregar contagem de pendentes
          const responseContagem = await apiRequest(
            "/api/denuncias-eticas/pendentes/contagem"
          );
          if (responseContagem.ok) {
            const contagem = await responseContagem.json();
            const badge = document.getElementById("badgeDenunciasPendentes");
            if (contagem > 0) {
              badge.textContent = `${contagem} pendente${
                contagem > 1 ? "s" : ""
              }`;
              badge.style.display = "inline-block";
            } else {
              badge.style.display = "none";
            }
          }

          // Carregar lista de den√∫ncias
          const filtro = document.getElementById("filtroStatusDenuncias").value;
          const url = filtro
            ? `/api/denuncias-eticas/status/${filtro}`
            : "/api/denuncias-eticas";

          const response = await apiRequest(url);
          if (response.ok) {
            const denuncias = await response.json();
            const container = document.getElementById("denunciasContainer");

            if (denuncias.length === 0) {
              container.innerHTML = `
                <div class="text-center text-muted py-4">
                  <p class="mb-0">Nenhuma den√∫ncia encontrada.</p>
                </div>
              `;
              return;
            }

            const html = denuncias
              .map((denuncia) => {
                const statusBadge =
                  {
                    PENDENTE: "bg-warning",
                    EM_ANALISE: "bg-info",
                    RESOLVIDA: "bg-success",
                    ARQUIVADA: "bg-secondary",
                  }[denuncia.status] || "bg-secondary";

                const dataFormatada = new Date(
                  denuncia.createdAt
                ).toLocaleString("pt-BR");
                const dataOcorrenciaFormatada = denuncia.dataOcorrencia
                  ? new Date(denuncia.dataOcorrencia).toLocaleString("pt-BR")
                  : "N√£o informada";

                return `
                <div class="card mb-3 border-start border-4 border-danger">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                      <div class="flex-grow-1">
                        <div class="d-flex align-items-center gap-2 mb-2">
                          <h6 class="mb-0 fw-bold">${denuncia.tipoDenuncia}</h6>
                          <span class="badge ${statusBadge}">${
                  denuncia.status
                }</span>
                        </div>
                        <p class="text-muted small mb-2">
                          <strong>Denunciante:</strong> ${
                            denuncia.denuncianteNome
                          } (${denuncia.denuncianteEmail})<br>
                          <strong>Data da Ocorr√™ncia:</strong> ${dataOcorrenciaFormatada}<br>
                          <strong>Local:</strong> ${
                            denuncia.localOcorrencia || "N√£o informado"
                          }<br>
                          <strong>Envolvidos:</strong> ${
                            denuncia.envolvidos || "N√£o informado"
                          }<br>
                          <strong>Registrada em:</strong> ${dataFormatada}
                        </p>
                      </div>
                    </div>
                    <div class="mb-3">
                      <strong>Descri√ß√£o:</strong>
                      <p class="mt-2">${denuncia.descricao}</p>
                    </div>
                    ${
                      denuncia.observacoesAdmin
                        ? `
                      <div class="alert alert-info mb-2">
                        <strong>Observa√ß√µes do Admin:</strong><br>
                        ${denuncia.observacoesAdmin}
                      </div>
                    `
                        : ""
                    }
                    <div class="d-flex gap-2">
                      <select class="form-select form-select-sm" style="width: auto;" id="statusSelect_${
                        denuncia.id
                      }">
                        <option value="PENDENTE" ${
                          denuncia.status === "PENDENTE" ? "selected" : ""
                        }>Pendente</option>
                        <option value="EM_ANALISE" ${
                          denuncia.status === "EM_ANALISE" ? "selected" : ""
                        }>Em An√°lise</option>
                        <option value="RESOLVIDA" ${
                          denuncia.status === "RESOLVIDA" ? "selected" : ""
                        }>Resolvida</option>
                        <option value="ARQUIVADA" ${
                          denuncia.status === "ARQUIVADA" ? "selected" : ""
                        }>Arquivada</option>
                      </select>
                      <button class="btn btn-sm btn-primary" onclick="atualizarStatusDenuncia('${
                        denuncia.id
                      }')">
                        Atualizar Status
                      </button>
                    </div>
                  </div>
                </div>
              `;
              })
              .join("");

            container.innerHTML = html;
          }
        } catch (error) {
          console.error("Erro ao carregar den√∫ncias:", error);
          const container = document.getElementById("denunciasContainer");
          if (container) {
            container.innerHTML = `
              <div class="alert alert-danger">
                Erro ao carregar den√∫ncias. Tente novamente mais tarde.
              </div>
            `;
          }
        }
      }

      // Atualizar status da den√∫ncia
      window.atualizarStatusDenuncia = async function (denunciaId) {
        const select = document.getElementById(`statusSelect_${denunciaId}`);
        const novoStatus = select.value;

        const observacoes = prompt("Observa√ß√µes do Admin (opcional):");

        try {
          const response = await apiRequest(
            `/api/denuncias-eticas/${denunciaId}/status`,
            {
              method: "PUT",
              body: JSON.stringify({
                status: novoStatus,
                observacoesAdmin: observacoes || null,
              }),
            }
          );

          if (response.ok) {
            alert("Status atualizado com sucesso!");
            carregarDenunciasEticas();
          } else {
            const error = await response.json();
            alert(
              "Erro: " +
                (error.message || "N√£o foi poss√≠vel atualizar o status")
            );
          }
        } catch (error) {
          console.error("Erro ao atualizar status:", error);
          alert("Erro ao atualizar status");
        }
      };

      // Event listeners para filtros
      document
        .getElementById("filtroStatusDenuncias")
        ?.addEventListener("change", () => {
          carregarDenunciasEticas();
        });

      document
        .getElementById("btnAtualizarDenuncias")
        ?.addEventListener("click", () => {
          carregarDenunciasEticas();
        });

      // Carregar dados iniciais
      if (userRole === "ADMIN") {
        carregarDenunciasEticas();
        // Atualizar a cada 2 minutos
        setInterval(() => {
          carregarDenunciasEticas();
        }, 120000);
      } else if (userRole === "PSICOLOGO") {
        carregarAvaliacoesProfundas();
        carregarMinhasAvaliacoes();
      } else {
        carregarFrequencia();
        carregarAgenda();
        carregarHistorico();

        // Atualizar a cada 5 minutos
        setInterval(() => {
          carregarAgenda();
          carregarFrequencia();
        }, 300000);
      }

      // ========== FUN√á√ïES DE INTELIG√äNCIA ARTIFICIAL ==========

      // Abrir Chat IA
      window.abrirChatIA = function () {
        const modal = new bootstrap.Modal(
          document.getElementById("modalChatIA")
        );
        modal.show();
        document
          .getElementById("chatInput")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              enviarMensagemChat();
            }
          });
      };

      // Enviar mensagem no chat
      window.enviarMensagemChat = async function () {
        const input = document.getElementById("chatInput");
        const mensagem = input.value.trim();
        if (!mensagem) return;

        const chatMessages = document.getElementById("chatMessages");

        // Adicionar mensagem do usu√°rio
        chatMessages.innerHTML += `
          <div class="alert alert-primary mb-2">
            <strong>${i18n.assistant.you}:</strong> ${mensagem}
          </div>
        `;
        input.value = "";

        // Mostrar loading
        chatMessages.innerHTML += `
          <div class="alert alert-secondary mb-2">
            <strong>Assistente:</strong> ${i18n.assistant.thinking}
          </div>
        `;
        chatMessages.scrollTop = chatMessages.scrollHeight;

        try {
          const response = await apiRequest("/api/ai/chat", {
            method: "POST",
            body: JSON.stringify({
              mensagem: mensagem,
              contexto: `Usu√°rio: ${userRole}`,
            }),
          });

          if (response.ok) {
            const data = await response.json();
            // Remover loading
            chatMessages.removeChild(chatMessages.lastChild);
            // Adicionar resposta
            chatMessages.innerHTML += `
              <div class="alert alert-info mb-2">
                <strong>Assistente:</strong> ${data.resposta}
              </div>
            `;
          } else {
            throw new Error("Erro na resposta");
          }
        } catch (error) {
          chatMessages.removeChild(chatMessages.lastChild);
          chatMessages.innerHTML += `
            <div class="alert alert-danger mb-2">
              ${i18n.assistant.error}
            </div>
          `;
        }
        chatMessages.scrollTop = chatMessages.scrollHeight;
      };

      // Abrir An√°lise de Sentimentos
      window.abrirAnaliseSentimento = function () {
        const modal = new bootstrap.Modal(
          document.getElementById("modalAnaliseSentimento")
        );
        modal.show();
        document.getElementById("resultadoAnalise").style.display = "none";
      };

      // Processar An√°lise de Sentimentos
      window.processarAnaliseSentimento = async function () {
        const texto = document.getElementById("analiseTexto").value;
        const nivelHumor = document.getElementById("analiseNivelHumor").value;
        const setor = document.getElementById("analiseSetor").value;

        if (!texto && !nivelHumor) {
          alert("Preencha pelo menos o texto ou o n√≠vel de humor");
          return;
        }

        const resultadoDiv = document.getElementById("resultadoAnalise");
        const conteudoDiv = document.getElementById("analiseConteudo");
        conteudoDiv.innerHTML = `<div class="spinner-border" role="status"><span class="visually-hidden">${i18n.modal.analysis.loading}</span></div>`;

        try {
          const response = await apiRequest("/api/ai/analise-sentimento", {
            method: "POST",
            body: JSON.stringify({
              texto: texto || "",
              nivelHumor: nivelHumor ? parseInt(nivelHumor) : null,
              setor: setor || "",
            }),
          });

          if (response.ok) {
            const data = await response.json();
            const sentimentoBadge =
              data.sentimento === "positivo"
                ? "success"
                : data.sentimento === "negativo"
                ? "danger"
                : "warning";

            conteudoDiv.innerHTML = `
              <div class="mb-3">
                <span class="badge bg-${sentimentoBadge}">${data.sentimento.toUpperCase()}</span>
                <span class="ms-2">Score: ${(data.score * 100).toFixed(
                  1
                )}%</span>
              </div>
              <div class="mb-3">
                <strong>Resumo:</strong>
                <p>${data.resumo}</p>
              </div>
              <div class="mb-3">
                <strong>Pontos Chave:</strong>
                <ul>
                  ${data.pontosChave.map((p) => `<li>${p}</li>`).join("")}
                </ul>
              </div>
              <div>
                <strong>Recomenda√ß√µes:</strong>
                <ul>
                  ${data.recomendacoes.map((r) => `<li>${r}</li>`).join("")}
                </ul>
              </div>
            `;
            resultadoDiv.style.display = "block";
          } else {
            throw new Error("Erro na an√°lise");
          }
        } catch (error) {
          conteudoDiv.innerHTML = `
            <div class="alert alert-danger">
              ${i18n.modal.analysis.error}
            </div>
          `;
        }
      };

      // Abrir Sugest√µes de Atividades
      window.abrirSugestaoAtividade = function () {
        const modal = new bootstrap.Modal(
          document.getElementById("modalSugestaoAtividade")
        );
        modal.show();
        document.getElementById("resultadoSugestao").style.display = "none";
      };

      // Processar Sugest√µes de Atividades
      window.processarSugestaoAtividade = async function () {
        const perfil = document.getElementById("sugestaoPerfil").value;
        const nivelHumor = document.getElementById("sugestaoNivelHumor").value;
        const setor = document.getElementById("sugestaoSetor").value;

        if (!perfil) {
          alert("Preencha o perfil do funcion√°rio");
          return;
        }

        const resultadoDiv = document.getElementById("resultadoSugestao");
        const conteudoDiv = document.getElementById("sugestaoConteudo");
        conteudoDiv.innerHTML =
          '<div class="spinner-border" role="status"><span class="visually-hidden">Carregando...</span></div>';

        try {
          const response = await apiRequest("/api/ai/sugerir-atividades", {
            method: "POST",
            body: JSON.stringify({
              perfilFuncionario: perfil,
              nivelHumor: nivelHumor ? parseInt(nivelHumor) : null,
              setor: setor || "",
              atividadesAnteriores: [],
            }),
          });

          if (response.ok) {
            const data = await response.json();
            conteudoDiv.innerHTML = `
              <div class="mb-3">
                <strong>Justificativa:</strong>
                <p>${data.justificativa}</p>
              </div>
              <div class="mb-3">
                <strong>Atividades Sugeridas (Prioridade ${
                  data.prioridade
                }):</strong>
                <ul class="list-group mt-2">
                  ${data.atividadesSugeridas
                    .map(
                      (a) => `
                    <li class="list-group-item">${a}</li>
                  `
                    )
                    .join("")}
                </ul>
              </div>
            `;
            resultadoDiv.style.display = "block";
          } else {
            throw new Error("Erro nas sugest√µes");
          }
        } catch (error) {
          conteudoDiv.innerHTML = `
            <div class="alert alert-danger">
              Erro ao obter sugest√µes. Tente novamente.
            </div>
          `;
        }
      };

      // Abrir Insights RH
      window.abrirInsightsRH = async function () {
        const modal = new bootstrap.Modal(
          document.getElementById("modalInsightsRH")
        );
        modal.show();

        const spinner = document.getElementById("insightsSpinner");
        const resultado = document.getElementById("resultadoInsights");
        const conteudo = document.getElementById("insightsConteudo");

        spinner.style.display = "block";
        resultado.style.display = "none";

        try {
          const response = await apiRequest("/api/dashboard-rh/insights-ai", {
            method: "POST",
          });

          if (response.ok) {
            const data = await response.json();
            spinner.style.display = "none";

            const tendenciaBadge =
              data.tendencia === "melhorando"
                ? "success"
                : data.tendencia === "preocupante"
                ? "danger"
                : "warning";

            conteudo.innerHTML = `
              <div class="mb-4">
                <h6 class="fw-bold">${i18n.modal.insights.executive}</h6>
                <p>${data.resumoExecutivo}</p>
              </div>
              <div class="row mb-4">
                <div class="col-md-6">
                  <h6 class="fw-bold text-success">${
                    i18n.modal.insights.positive
                  }</h6>
                  <ul>
                    ${data.pontosPositivos.map((p) => `<li>${p}</li>`).join("")}
                  </ul>
                </div>
                <div class="col-md-6">
                  <h6 class="fw-bold text-danger">${
                    i18n.modal.insights.critical
                  }</h6>
                  <ul>
                    ${data.pontosCriticos.map((p) => `<li>${p}</li>`).join("")}
                  </ul>
                </div>
              </div>
              <div class="mb-4">
                <h6 class="fw-bold">${i18n.modal.insights.recommendations}</h6>
                <ul>
                  ${data.recomendacoes.map((r) => `<li>${r}</li>`).join("")}
                </ul>
              </div>
              <div>
                <span class="badge bg-${tendenciaBadge}">${
              i18n.modal.insights.trend
            }: ${data.tendencia}</span>
              </div>
            `;
            resultado.style.display = "block";
          } else {
            throw new Error("Erro nos insights");
          }
        } catch (error) {
          spinner.style.display = "none";
          conteudo.innerHTML = `
            <div class="alert alert-danger">
              ${i18n.modal.insights.error}
            </div>
          `;
          resultado.style.display = "block";
        }
      };
    </script>
  </body>
</html>
